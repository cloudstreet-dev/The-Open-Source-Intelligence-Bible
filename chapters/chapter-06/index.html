<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="A Comprehensive Technical Guide to Modern OSINT Practice"><meta name=author content=CloudStreet><link href=https://cloudstreet-dev.github.io/The-Open-Source-Intelligence-Bible/chapters/chapter-06/ rel=canonical><link href=../chapter-05/ rel=prev><link href=../chapter-07/ rel=next><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.7.3"><title>Ch 6: Domain and Network Recon - The Open Source Intelligence Bible</title><link rel=stylesheet href=../../assets/stylesheets/main.484c7ddc.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.ab4e12ef.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Inter:300,300i,400,400i,700,700i%7CJetBrains+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Inter";--md-code-font:"JetBrains Mono"}</style><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#chapter-6-domain-and-network-reconnaissance class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="The Open Source Intelligence Bible" class="md-header__button md-logo" aria-label="The Open Source Intelligence Bible" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> The Open Source Intelligence Bible </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Ch 6: Domain and Network Recon </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/cloudstreet-dev/The-Open-Source-Intelligence-Bible title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> cloudstreet-dev/The-Open-Source-Intelligence-Bible </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../chapter-01/ class=md-tabs__link> Part I — Foundations </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../chapter-05/ class=md-tabs__link> Part II — Core Collection </a> </li> <li class=md-tabs__item> <a href=../chapter-10/ class=md-tabs__link> Part III — AI and Data Processing </a> </li> <li class=md-tabs__item> <a href=../chapter-14/ class=md-tabs__link> Part IV — Automation and Tooling </a> </li> <li class=md-tabs__item> <a href=../chapter-18/ class=md-tabs__link> Part V — Applied Domains </a> </li> <li class=md-tabs__item> <a href=../chapter-23/ class=md-tabs__link> Part VI — Enterprise and Advanced </a> </li> <li class=md-tabs__item> <a href=../chapter-28/ class=md-tabs__link> Part VII — Professional Practice </a> </li> <li class=md-tabs__item> <a href=../../appendices/appendix-a-tool-reference/ class=md-tabs__link> Appendices </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="The Open Source Intelligence Bible" class="md-nav__button md-logo" aria-label="The Open Source Intelligence Bible" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> The Open Source Intelligence Bible </label> <div class=md-nav__source> <a href=https://github.com/cloudstreet-dev/The-Open-Source-Intelligence-Bible title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> cloudstreet-dev/The-Open-Source-Intelligence-Bible </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> <span class=md-ellipsis> Part I — Foundations </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Part I — Foundations </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../chapter-01/ class=md-nav__link> <span class=md-ellipsis> Ch 1: What OSINT Is </span> </a> </li> <li class=md-nav__item> <a href=../chapter-02/ class=md-nav__link> <span class=md-ellipsis> Ch 2: The Data Landscape </span> </a> </li> <li class=md-nav__item> <a href=../chapter-03/ class=md-nav__link> <span class=md-ellipsis> Ch 3: Legal and Ethical Frameworks </span> </a> </li> <li class=md-nav__item> <a href=../chapter-04/ class=md-nav__link> <span class=md-ellipsis> Ch 4: Core Investigative Workflow </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3 checked> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex> <span class=md-ellipsis> Part II — Core Collection </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=true> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Part II — Core Collection </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../chapter-05/ class=md-nav__link> <span class=md-ellipsis> Ch 5: Social Media Intelligence </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Ch 6: Domain and Network Recon </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Ch 6: Domain and Network Recon </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#learning-objectives class=md-nav__link> <span class=md-ellipsis> Learning Objectives </span> </a> </li> <li class=md-nav__item> <a href=#61-why-network-reconnaissance-matters class=md-nav__link> <span class=md-ellipsis> 6.1 Why Network Reconnaissance Matters </span> </a> </li> <li class=md-nav__item> <a href=#62-domain-intelligence class=md-nav__link> <span class=md-ellipsis> 6.2 Domain Intelligence </span> </a> <nav class=md-nav aria-label="6.2 Domain Intelligence"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#whois-analysis class=md-nav__link> <span class=md-ellipsis> WHOIS Analysis </span> </a> </li> <li class=md-nav__item> <a href=#historical-whois-data class=md-nav__link> <span class=md-ellipsis> Historical WHOIS Data </span> </a> </li> <li class=md-nav__item> <a href=#dns-record-analysis class=md-nav__link> <span class=md-ellipsis> DNS Record Analysis </span> </a> </li> <li class=md-nav__item> <a href=#certificate-transparency-analysis class=md-nav__link> <span class=md-ellipsis> Certificate Transparency Analysis </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#63-ip-address-intelligence class=md-nav__link> <span class=md-ellipsis> 6.3 IP Address Intelligence </span> </a> <nav class=md-nav aria-label="6.3 IP Address Intelligence"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#ip-whois-and-asn-research class=md-nav__link> <span class=md-ellipsis> IP WHOIS and ASN Research </span> </a> </li> <li class=md-nav__item> <a href=#passive-dns class=md-nav__link> <span class=md-ellipsis> Passive DNS </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#64-shodan-censys-and-internet-scanning-databases class=md-nav__link> <span class=md-ellipsis> 6.4 Shodan, Censys, and Internet Scanning Databases </span> </a> <nav class=md-nav aria-label="6.4 Shodan, Censys, and Internet Scanning Databases"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#shodan class=md-nav__link> <span class=md-ellipsis> Shodan </span> </a> </li> <li class=md-nav__item> <a href=#censys class=md-nav__link> <span class=md-ellipsis> Censys </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#65-subdomain-enumeration class=md-nav__link> <span class=md-ellipsis> 6.5 Subdomain Enumeration </span> </a> <nav class=md-nav aria-label="6.5 Subdomain Enumeration"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#passive-subdomain-discovery class=md-nav__link> <span class=md-ellipsis> Passive Subdomain Discovery </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#66-email-infrastructure-analysis class=md-nav__link> <span class=md-ellipsis> 6.6 Email Infrastructure Analysis </span> </a> <nav class=md-nav aria-label="6.6 Email Infrastructure Analysis"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#mx-record-analysis class=md-nav__link> <span class=md-ellipsis> MX Record Analysis </span> </a> </li> <li class=md-nav__item> <a href=#spf-analysis class=md-nav__link> <span class=md-ellipsis> SPF Analysis </span> </a> </li> <li class=md-nav__item> <a href=#dmarc-analysis class=md-nav__link> <span class=md-ellipsis> DMARC Analysis </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#67-building-automated-recon-pipelines class=md-nav__link> <span class=md-ellipsis> 6.7 Building Automated Recon Pipelines </span> </a> </li> <li class=md-nav__item> <a href=#68-threat-actor-infrastructure-research class=md-nav__link> <span class=md-ellipsis> 6.8 Threat Actor Infrastructure Research </span> </a> <nav class=md-nav aria-label="6.8 Threat Actor Infrastructure Research"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#infrastructure-correlation-techniques class=md-nav__link> <span class=md-ellipsis> Infrastructure Correlation Techniques </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#summary class=md-nav__link> <span class=md-ellipsis> Summary </span> </a> </li> <li class=md-nav__item> <a href=#common-mistakes-and-pitfalls class=md-nav__link> <span class=md-ellipsis> Common Mistakes and Pitfalls </span> </a> </li> <li class=md-nav__item> <a href=#further-reading class=md-nav__link> <span class=md-ellipsis> Further Reading </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../chapter-07/ class=md-nav__link> <span class=md-ellipsis> Ch 7: Public Records </span> </a> </li> <li class=md-nav__item> <a href=../chapter-08/ class=md-nav__link> <span class=md-ellipsis> Ch 8: Geospatial Intelligence </span> </a> </li> <li class=md-nav__item> <a href=../chapter-09/ class=md-nav__link> <span class=md-ellipsis> Ch 9: Advanced Search and Historical Data </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> <span class=md-ellipsis> Part III — AI and Data Processing </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Part III — AI and Data Processing </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../chapter-10/ class=md-nav__link> <span class=md-ellipsis> Ch 10: AI Fundamentals </span> </a> </li> <li class=md-nav__item> <a href=../chapter-11/ class=md-nav__link> <span class=md-ellipsis> Ch 11: Processing Unstructured Data at Scale </span> </a> </li> <li class=md-nav__item> <a href=../chapter-12/ class=md-nav__link> <span class=md-ellipsis> Ch 12: LLMs and Prompt Engineering </span> </a> </li> <li class=md-nav__item> <a href=../chapter-13/ class=md-nav__link> <span class=md-ellipsis> Ch 13: Network Analysis and Graph Intelligence </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex=0> <span class=md-ellipsis> Part IV — Automation and Tooling </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Part IV — Automation and Tooling </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../chapter-14/ class=md-nav__link> <span class=md-ellipsis> Ch 14: Automation and Investigative Pipelines </span> </a> </li> <li class=md-nav__item> <a href=../chapter-15/ class=md-nav__link> <span class=md-ellipsis> Ch 15: The OSINT Tool Ecosystem </span> </a> </li> <li class=md-nav__item> <a href=../chapter-16/ class=md-nav__link> <span class=md-ellipsis> Ch 16: AI-Enhanced Investigative Platforms </span> </a> </li> <li class=md-nav__item> <a href=../chapter-17/ class=md-nav__link> <span class=md-ellipsis> Ch 17: Visualization and Reporting </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex=0> <span class=md-ellipsis> Part V — Applied Domains </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Part V — Applied Domains </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../chapter-18/ class=md-nav__link> <span class=md-ellipsis> Ch 18: Private Investigator Workflows </span> </a> </li> <li class=md-nav__item> <a href=../chapter-19/ class=md-nav__link> <span class=md-ellipsis> Ch 19: Bounty Hunting and Vulnerability Research </span> </a> </li> <li class=md-nav__item> <a href=../chapter-20/ class=md-nav__link> <span class=md-ellipsis> Ch 20: Threat Intelligence and Cybersecurity </span> </a> </li> <li class=md-nav__item> <a href=../chapter-21/ class=md-nav__link> <span class=md-ellipsis> Ch 21: Financial Crime and AML </span> </a> </li> <li class=md-nav__item> <a href=../chapter-22/ class=md-nav__link> <span class=md-ellipsis> Ch 22: Corporate Security and Due Diligence </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7 id=__nav_7_label tabindex=0> <span class=md-ellipsis> Part VI — Enterprise and Advanced </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_7_label aria-expanded=false> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Part VI — Enterprise and Advanced </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../chapter-23/ class=md-nav__link> <span class=md-ellipsis> Ch 23: Enterprise-Scale Analysis </span> </a> </li> <li class=md-nav__item> <a href=../chapter-24/ class=md-nav__link> <span class=md-ellipsis> Ch 24: Adversarial OSINT and Counter-Intelligence </span> </a> </li> <li class=md-nav__item> <a href=../chapter-25/ class=md-nav__link> <span class=md-ellipsis> Ch 25: Emerging Technologies and Future AI </span> </a> </li> <li class=md-nav__item> <a href=../chapter-26/ class=md-nav__link> <span class=md-ellipsis> Ch 26: Operational Security and Risk Management </span> </a> </li> <li class=md-nav__item> <a href=../chapter-27/ class=md-nav__link> <span class=md-ellipsis> Ch 27: Designing Your OSINT Stack </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_8> <label class=md-nav__link for=__nav_8 id=__nav_8_label tabindex=0> <span class=md-ellipsis> Part VII — Professional Practice </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_8_label aria-expanded=false> <label class=md-nav__title for=__nav_8> <span class="md-nav__icon md-icon"></span> Part VII — Professional Practice </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../chapter-28/ class=md-nav__link> <span class=md-ellipsis> Ch 28: Real-World Case Studies </span> </a> </li> <li class=md-nav__item> <a href=../chapter-29/ class=md-nav__link> <span class=md-ellipsis> Ch 29: Pitfalls, Bias, and Failure Modes </span> </a> </li> <li class=md-nav__item> <a href=../chapter-30/ class=md-nav__link> <span class=md-ellipsis> Ch 30: The Future of OSINT Practice </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_9> <label class=md-nav__link for=__nav_9 id=__nav_9_label tabindex=0> <span class=md-ellipsis> Appendices </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_9_label aria-expanded=false> <label class=md-nav__title for=__nav_9> <span class="md-nav__icon md-icon"></span> Appendices </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../appendices/appendix-a-tool-reference/ class=md-nav__link> <span class=md-ellipsis> Appendix A: Tool Reference </span> </a> </li> <li class=md-nav__item> <a href=../../appendices/appendix-b-python-examples/ class=md-nav__link> <span class=md-ellipsis> Appendix B: Python Code Examples </span> </a> </li> <li class=md-nav__item> <a href=../../appendices/appendix-c-legal-resources/ class=md-nav__link> <span class=md-ellipsis> Appendix C: Legal Resources </span> </a> </li> <li class=md-nav__item> <a href=../../appendices/appendix-d-glossary/ class=md-nav__link> <span class=md-ellipsis> Appendix D: Glossary </span> </a> </li> <li class=md-nav__item> <a href=../../appendices/appendix-e-further-reading/ class=md-nav__link> <span class=md-ellipsis> Appendix E: Further Reading </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#learning-objectives class=md-nav__link> <span class=md-ellipsis> Learning Objectives </span> </a> </li> <li class=md-nav__item> <a href=#61-why-network-reconnaissance-matters class=md-nav__link> <span class=md-ellipsis> 6.1 Why Network Reconnaissance Matters </span> </a> </li> <li class=md-nav__item> <a href=#62-domain-intelligence class=md-nav__link> <span class=md-ellipsis> 6.2 Domain Intelligence </span> </a> <nav class=md-nav aria-label="6.2 Domain Intelligence"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#whois-analysis class=md-nav__link> <span class=md-ellipsis> WHOIS Analysis </span> </a> </li> <li class=md-nav__item> <a href=#historical-whois-data class=md-nav__link> <span class=md-ellipsis> Historical WHOIS Data </span> </a> </li> <li class=md-nav__item> <a href=#dns-record-analysis class=md-nav__link> <span class=md-ellipsis> DNS Record Analysis </span> </a> </li> <li class=md-nav__item> <a href=#certificate-transparency-analysis class=md-nav__link> <span class=md-ellipsis> Certificate Transparency Analysis </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#63-ip-address-intelligence class=md-nav__link> <span class=md-ellipsis> 6.3 IP Address Intelligence </span> </a> <nav class=md-nav aria-label="6.3 IP Address Intelligence"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#ip-whois-and-asn-research class=md-nav__link> <span class=md-ellipsis> IP WHOIS and ASN Research </span> </a> </li> <li class=md-nav__item> <a href=#passive-dns class=md-nav__link> <span class=md-ellipsis> Passive DNS </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#64-shodan-censys-and-internet-scanning-databases class=md-nav__link> <span class=md-ellipsis> 6.4 Shodan, Censys, and Internet Scanning Databases </span> </a> <nav class=md-nav aria-label="6.4 Shodan, Censys, and Internet Scanning Databases"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#shodan class=md-nav__link> <span class=md-ellipsis> Shodan </span> </a> </li> <li class=md-nav__item> <a href=#censys class=md-nav__link> <span class=md-ellipsis> Censys </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#65-subdomain-enumeration class=md-nav__link> <span class=md-ellipsis> 6.5 Subdomain Enumeration </span> </a> <nav class=md-nav aria-label="6.5 Subdomain Enumeration"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#passive-subdomain-discovery class=md-nav__link> <span class=md-ellipsis> Passive Subdomain Discovery </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#66-email-infrastructure-analysis class=md-nav__link> <span class=md-ellipsis> 6.6 Email Infrastructure Analysis </span> </a> <nav class=md-nav aria-label="6.6 Email Infrastructure Analysis"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#mx-record-analysis class=md-nav__link> <span class=md-ellipsis> MX Record Analysis </span> </a> </li> <li class=md-nav__item> <a href=#spf-analysis class=md-nav__link> <span class=md-ellipsis> SPF Analysis </span> </a> </li> <li class=md-nav__item> <a href=#dmarc-analysis class=md-nav__link> <span class=md-ellipsis> DMARC Analysis </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#67-building-automated-recon-pipelines class=md-nav__link> <span class=md-ellipsis> 6.7 Building Automated Recon Pipelines </span> </a> </li> <li class=md-nav__item> <a href=#68-threat-actor-infrastructure-research class=md-nav__link> <span class=md-ellipsis> 6.8 Threat Actor Infrastructure Research </span> </a> <nav class=md-nav aria-label="6.8 Threat Actor Infrastructure Research"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#infrastructure-correlation-techniques class=md-nav__link> <span class=md-ellipsis> Infrastructure Correlation Techniques </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#summary class=md-nav__link> <span class=md-ellipsis> Summary </span> </a> </li> <li class=md-nav__item> <a href=#common-mistakes-and-pitfalls class=md-nav__link> <span class=md-ellipsis> Common Mistakes and Pitfalls </span> </a> </li> <li class=md-nav__item> <a href=#further-reading class=md-nav__link> <span class=md-ellipsis> Further Reading </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=chapter-6-domain-and-network-reconnaissance>Chapter 6: Domain and Network Reconnaissance<a class=headerlink href=#chapter-6-domain-and-network-reconnaissance title="Permanent link">&para;</a></h1> <h2 id=learning-objectives>Learning Objectives<a class=headerlink href=#learning-objectives title="Permanent link">&para;</a></h2> <p>By the end of this chapter, you will be able to: - Conduct systematic domain and DNS reconnaissance - Map organizational network infrastructure from public sources - Use passive and active reconnaissance techniques appropriately - Extract intelligence from certificate transparency logs - Analyze historical DNS and WHOIS data - Use Shodan and similar tools for internet infrastructure analysis - Build automated recon pipelines for repeatable workflows</p> <hr> <h2 id=61-why-network-reconnaissance-matters>6.1 Why Network Reconnaissance Matters<a class=headerlink href=#61-why-network-reconnaissance-matters title="Permanent link">&para;</a></h2> <p>Every organization that maintains a web presence, email infrastructure, or cloud presence generates a significant public footprint in the Domain Name System, IP address allocation records, certificate authorities, and internet-wide scanning databases. This footprint is often more revealing than organizations realize.</p> <p>Network reconnaissance — the systematic mapping of an organization's internet infrastructure — serves several legitimate OSINT purposes:</p> <ul> <li><strong>Attack surface analysis</strong>: Understanding what an organization exposes to the internet, used defensively and in authorized penetration testing</li> <li><strong>Corporate investigations</strong>: Identifying the technical infrastructure of an organization under due diligence or investigation</li> <li><strong>Threat actor tracking</strong>: Mapping the infrastructure of threat groups using C2 servers, phishing domains, or malware distribution sites</li> <li><strong>Brand protection</strong>: Identifying unauthorized uses of a brand's domain patterns</li> <li><strong>Investigative journalism</strong>: Understanding the technical infrastructure behind disinformation campaigns or fraud operations</li> </ul> <p>The same techniques that security professionals use to harden defenses are used by investigators to map adversary infrastructure and by journalists to expose coordinated deception campaigns.</p> <hr> <h2 id=62-domain-intelligence>6.2 Domain Intelligence<a class=headerlink href=#62-domain-intelligence title="Permanent link">&para;</a></h2> <h3 id=whois-analysis>WHOIS Analysis<a class=headerlink href=#whois-analysis title="Permanent link">&para;</a></h3> <p>WHOIS is the protocol for querying domain registration information. Historically, WHOIS records contained registrant name, organization, address, phone, and email. GDPR compliance has significantly reduced the public availability of this data for European registrants, but:</p> <ul> <li>Many non-EU registrations still include full registrant data</li> <li>Historical WHOIS data (captured before GDPR) is available through specialized databases</li> <li>Organization names, nameservers, and technical contact emails often remain visible</li> <li>Business domain registrations may retain more data than personal registrations</li> </ul> <p><strong>Key WHOIS data points</strong>: - Registrar (which company registered the domain) - Registration and expiration dates - Nameservers (which DNS infrastructure serves the domain) - Registrant organization (often preserved even with individual data redacted) - Privacy proxy service (presence of a privacy proxy reveals intent to obscure ownership)</p> <p><strong>Tools</strong>: <div class="language-bash highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=c1># Command-line WHOIS</span>
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a>whois<span class=w> </span>example.com
</span><span id=__span-0-3><a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a>
</span><span id=__span-0-4><a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a><span class=c1># Domain-specific WHOIS query (for more detailed results)</span>
</span><span id=__span-0-5><a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a>whois<span class=w> </span>-h<span class=w> </span>whois.verisign-grs.com<span class=w> </span>example.com
</span><span id=__span-0-6><a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a>
</span><span id=__span-0-7><a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a><span class=c1># Python whois library</span>
</span><span id=__span-0-8><a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a>python3<span class=w> </span>-c<span class=w> </span><span class=s2>&quot;import whois; w = whois.whois(&#39;example.com&#39;); print(w)&quot;</span>
</span></code></pre></div></p> <div class="language-python highlight"><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=kn>import</span><span class=w> </span><span class=nn>whois</span>
</span><span id=__span-1-2><a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a><span class=kn>import</span><span class=w> </span><span class=nn>json</span>
</span><span id=__span-1-3><a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a><span class=kn>from</span><span class=w> </span><span class=nn>datetime</span><span class=w> </span><span class=kn>import</span> <span class=n>datetime</span>
</span><span id=__span-1-4><a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a>
</span><span id=__span-1-5><a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a><span class=k>def</span><span class=w> </span><span class=nf>analyze_domain_whois</span><span class=p>(</span><span class=n>domain</span><span class=p>):</span>
</span><span id=__span-1-6><a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Extract and structure WHOIS data for analysis&quot;&quot;&quot;</span>
</span><span id=__span-1-7><a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a>    <span class=k>try</span><span class=p>:</span>
</span><span id=__span-1-8><a id=__codelineno-1-8 name=__codelineno-1-8 href=#__codelineno-1-8></a>        <span class=n>w</span> <span class=o>=</span> <span class=n>whois</span><span class=o>.</span><span class=n>whois</span><span class=p>(</span><span class=n>domain</span><span class=p>)</span>
</span><span id=__span-1-9><a id=__codelineno-1-9 name=__codelineno-1-9 href=#__codelineno-1-9></a>        <span class=k>return</span> <span class=p>{</span>
</span><span id=__span-1-10><a id=__codelineno-1-10 name=__codelineno-1-10 href=#__codelineno-1-10></a>            <span class=s1>&#39;domain&#39;</span><span class=p>:</span> <span class=n>domain</span><span class=p>,</span>
</span><span id=__span-1-11><a id=__codelineno-1-11 name=__codelineno-1-11 href=#__codelineno-1-11></a>            <span class=s1>&#39;registrar&#39;</span><span class=p>:</span> <span class=n>w</span><span class=o>.</span><span class=n>registrar</span><span class=p>,</span>
</span><span id=__span-1-12><a id=__codelineno-1-12 name=__codelineno-1-12 href=#__codelineno-1-12></a>            <span class=s1>&#39;created&#39;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>w</span><span class=o>.</span><span class=n>creation_date</span><span class=p>)</span> <span class=k>if</span> <span class=n>w</span><span class=o>.</span><span class=n>creation_date</span> <span class=k>else</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-1-13><a id=__codelineno-1-13 name=__codelineno-1-13 href=#__codelineno-1-13></a>            <span class=s1>&#39;expires&#39;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>w</span><span class=o>.</span><span class=n>expiration_date</span><span class=p>)</span> <span class=k>if</span> <span class=n>w</span><span class=o>.</span><span class=n>expiration_date</span> <span class=k>else</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-1-14><a id=__codelineno-1-14 name=__codelineno-1-14 href=#__codelineno-1-14></a>            <span class=s1>&#39;updated&#39;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>w</span><span class=o>.</span><span class=n>updated_date</span><span class=p>)</span> <span class=k>if</span> <span class=n>w</span><span class=o>.</span><span class=n>updated_date</span> <span class=k>else</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-1-15><a id=__codelineno-1-15 name=__codelineno-1-15 href=#__codelineno-1-15></a>            <span class=s1>&#39;nameservers&#39;</span><span class=p>:</span> <span class=nb>list</span><span class=p>(</span><span class=n>w</span><span class=o>.</span><span class=n>name_servers</span><span class=p>)</span> <span class=k>if</span> <span class=n>w</span><span class=o>.</span><span class=n>name_servers</span> <span class=k>else</span> <span class=p>[],</span>
</span><span id=__span-1-16><a id=__codelineno-1-16 name=__codelineno-1-16 href=#__codelineno-1-16></a>            <span class=s1>&#39;registrant_org&#39;</span><span class=p>:</span> <span class=n>w</span><span class=o>.</span><span class=n>org</span><span class=p>,</span>
</span><span id=__span-1-17><a id=__codelineno-1-17 name=__codelineno-1-17 href=#__codelineno-1-17></a>            <span class=s1>&#39;registrant_country&#39;</span><span class=p>:</span> <span class=n>w</span><span class=o>.</span><span class=n>country</span><span class=p>,</span>
</span><span id=__span-1-18><a id=__codelineno-1-18 name=__codelineno-1-18 href=#__codelineno-1-18></a>            <span class=s1>&#39;status&#39;</span><span class=p>:</span> <span class=n>w</span><span class=o>.</span><span class=n>status</span><span class=p>,</span>
</span><span id=__span-1-19><a id=__codelineno-1-19 name=__codelineno-1-19 href=#__codelineno-1-19></a>        <span class=p>}</span>
</span><span id=__span-1-20><a id=__codelineno-1-20 name=__codelineno-1-20 href=#__codelineno-1-20></a>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-1-21><a id=__codelineno-1-21 name=__codelineno-1-21 href=#__codelineno-1-21></a>        <span class=k>return</span> <span class=p>{</span><span class=s1>&#39;domain&#39;</span><span class=p>:</span> <span class=n>domain</span><span class=p>,</span> <span class=s1>&#39;error&#39;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)}</span>
</span><span id=__span-1-22><a id=__codelineno-1-22 name=__codelineno-1-22 href=#__codelineno-1-22></a>
</span><span id=__span-1-23><a id=__codelineno-1-23 name=__codelineno-1-23 href=#__codelineno-1-23></a><span class=c1># Analyze a set of suspected related domains</span>
</span><span id=__span-1-24><a id=__codelineno-1-24 name=__codelineno-1-24 href=#__codelineno-1-24></a><span class=n>domains</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;example.com&#39;</span><span class=p>,</span> <span class=s1>&#39;example-corp.com&#39;</span><span class=p>,</span> <span class=s1>&#39;example-login.com&#39;</span><span class=p>]</span>
</span><span id=__span-1-25><a id=__codelineno-1-25 name=__codelineno-1-25 href=#__codelineno-1-25></a><span class=n>results</span> <span class=o>=</span> <span class=p>[</span><span class=n>analyze_domain_whois</span><span class=p>(</span><span class=n>d</span><span class=p>)</span> <span class=k>for</span> <span class=n>d</span> <span class=ow>in</span> <span class=n>domains</span><span class=p>]</span>
</span></code></pre></div> <h3 id=historical-whois-data>Historical WHOIS Data<a class=headerlink href=#historical-whois-data title="Permanent link">&para;</a></h3> <p>GDPR and privacy proxy services have obscured current WHOIS data, but historical snapshots remain accessible through commercial services:</p> <ul> <li><strong>DomainTools</strong>: The most comprehensive historical WHOIS database. Commercial.</li> <li><strong>SecurityTrails</strong>: Historical WHOIS data combined with DNS history. Free tier available, commercial for bulk access.</li> <li><strong>ViewDNS.info</strong>: Free historical WHOIS queries with some limitations.</li> <li><strong>WhoisFreaks</strong>: Historical WHOIS API access.</li> </ul> <p>Historical WHOIS is particularly valuable for: - Identifying who originally registered a now-privacy-protected domain - Correlating domains registered with the same registrant information - Tracking domain ownership changes over time - Establishing timeline of domain use</p> <h3 id=dns-record-analysis>DNS Record Analysis<a class=headerlink href=#dns-record-analysis title="Permanent link">&para;</a></h3> <p>DNS records are fully public and revealing. A complete DNS analysis should collect:</p> <p><strong>A and AAAA records</strong>: IPv4 and IPv6 addresses the domain resolves to. These reveal hosting providers, CDN usage, and network relationships.</p> <p><strong>MX records</strong>: Mail exchange servers. These reveal email provider (Google Workspace, Microsoft 365, Proofpoint), which has implications for security posture and organizational setup.</p> <p><strong>TXT records</strong>: Text records used for SPF (which servers are authorized to send email for this domain), DKIM (email signing keys), DMARC (email authentication policy), domain ownership verification tokens, and sometimes internal infrastructure information.</p> <p><strong>NS records</strong>: Authoritative nameservers. These reveal DNS provider and sometimes organizational information.</p> <p><strong>CNAME records</strong>: Canonical name aliases, which often reveal use of specific CDN, hosting, or SaaS services.</p> <p><strong>SOA record</strong>: Start of Authority record containing the primary nameserver and administrative email (sometimes a real email address even on privacy-protected domains).</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=kn>import</span><span class=w> </span><span class=nn>dns.resolver</span>
</span><span id=__span-2-2><a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a><span class=kn>import</span><span class=w> </span><span class=nn>dns.zone</span>
</span><span id=__span-2-3><a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a><span class=kn>import</span><span class=w> </span><span class=nn>dns.reversename</span>
</span><span id=__span-2-4><a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a>
</span><span id=__span-2-5><a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a><span class=k>def</span><span class=w> </span><span class=nf>full_dns_analysis</span><span class=p>(</span><span class=n>domain</span><span class=p>):</span>
</span><span id=__span-2-6><a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Comprehensive DNS record collection&quot;&quot;&quot;</span>
</span><span id=__span-2-7><a id=__codelineno-2-7 name=__codelineno-2-7 href=#__codelineno-2-7></a>    <span class=n>results</span> <span class=o>=</span> <span class=p>{}</span>
</span><span id=__span-2-8><a id=__codelineno-2-8 name=__codelineno-2-8 href=#__codelineno-2-8></a>    <span class=n>record_types</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;A&#39;</span><span class=p>,</span> <span class=s1>&#39;AAAA&#39;</span><span class=p>,</span> <span class=s1>&#39;MX&#39;</span><span class=p>,</span> <span class=s1>&#39;NS&#39;</span><span class=p>,</span> <span class=s1>&#39;TXT&#39;</span><span class=p>,</span> <span class=s1>&#39;SOA&#39;</span><span class=p>,</span> <span class=s1>&#39;CNAME&#39;</span><span class=p>]</span>
</span><span id=__span-2-9><a id=__codelineno-2-9 name=__codelineno-2-9 href=#__codelineno-2-9></a>
</span><span id=__span-2-10><a id=__codelineno-2-10 name=__codelineno-2-10 href=#__codelineno-2-10></a>    <span class=n>resolver</span> <span class=o>=</span> <span class=n>dns</span><span class=o>.</span><span class=n>resolver</span><span class=o>.</span><span class=n>Resolver</span><span class=p>()</span>
</span><span id=__span-2-11><a id=__codelineno-2-11 name=__codelineno-2-11 href=#__codelineno-2-11></a>    <span class=n>resolver</span><span class=o>.</span><span class=n>timeout</span> <span class=o>=</span> <span class=mi>5</span>
</span><span id=__span-2-12><a id=__codelineno-2-12 name=__codelineno-2-12 href=#__codelineno-2-12></a>    <span class=n>resolver</span><span class=o>.</span><span class=n>lifetime</span> <span class=o>=</span> <span class=mi>10</span>
</span><span id=__span-2-13><a id=__codelineno-2-13 name=__codelineno-2-13 href=#__codelineno-2-13></a>
</span><span id=__span-2-14><a id=__codelineno-2-14 name=__codelineno-2-14 href=#__codelineno-2-14></a>    <span class=k>for</span> <span class=n>rtype</span> <span class=ow>in</span> <span class=n>record_types</span><span class=p>:</span>
</span><span id=__span-2-15><a id=__codelineno-2-15 name=__codelineno-2-15 href=#__codelineno-2-15></a>        <span class=k>try</span><span class=p>:</span>
</span><span id=__span-2-16><a id=__codelineno-2-16 name=__codelineno-2-16 href=#__codelineno-2-16></a>            <span class=n>answers</span> <span class=o>=</span> <span class=n>resolver</span><span class=o>.</span><span class=n>resolve</span><span class=p>(</span><span class=n>domain</span><span class=p>,</span> <span class=n>rtype</span><span class=p>)</span>
</span><span id=__span-2-17><a id=__codelineno-2-17 name=__codelineno-2-17 href=#__codelineno-2-17></a>            <span class=n>results</span><span class=p>[</span><span class=n>rtype</span><span class=p>]</span> <span class=o>=</span> <span class=p>[</span><span class=nb>str</span><span class=p>(</span><span class=n>rdata</span><span class=p>)</span> <span class=k>for</span> <span class=n>rdata</span> <span class=ow>in</span> <span class=n>answers</span><span class=p>]</span>
</span><span id=__span-2-18><a id=__codelineno-2-18 name=__codelineno-2-18 href=#__codelineno-2-18></a>        <span class=k>except</span> <span class=p>(</span><span class=n>dns</span><span class=o>.</span><span class=n>resolver</span><span class=o>.</span><span class=n>NoAnswer</span><span class=p>,</span> <span class=n>dns</span><span class=o>.</span><span class=n>resolver</span><span class=o>.</span><span class=n>NXDOMAIN</span><span class=p>,</span>
</span><span id=__span-2-19><a id=__codelineno-2-19 name=__codelineno-2-19 href=#__codelineno-2-19></a>                <span class=n>dns</span><span class=o>.</span><span class=n>resolver</span><span class=o>.</span><span class=n>NoNameservers</span><span class=p>,</span> <span class=n>dns</span><span class=o>.</span><span class=n>exception</span><span class=o>.</span><span class=n>Timeout</span><span class=p>):</span>
</span><span id=__span-2-20><a id=__codelineno-2-20 name=__codelineno-2-20 href=#__codelineno-2-20></a>            <span class=n>results</span><span class=p>[</span><span class=n>rtype</span><span class=p>]</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-2-21><a id=__codelineno-2-21 name=__codelineno-2-21 href=#__codelineno-2-21></a>
</span><span id=__span-2-22><a id=__codelineno-2-22 name=__codelineno-2-22 href=#__codelineno-2-22></a>    <span class=c1># Parse SPF record for authorized senders</span>
</span><span id=__span-2-23><a id=__codelineno-2-23 name=__codelineno-2-23 href=#__codelineno-2-23></a>    <span class=k>if</span> <span class=n>results</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;TXT&#39;</span><span class=p>):</span>
</span><span id=__span-2-24><a id=__codelineno-2-24 name=__codelineno-2-24 href=#__codelineno-2-24></a>        <span class=k>for</span> <span class=n>txt</span> <span class=ow>in</span> <span class=n>results</span><span class=p>[</span><span class=s1>&#39;TXT&#39;</span><span class=p>]:</span>
</span><span id=__span-2-25><a id=__codelineno-2-25 name=__codelineno-2-25 href=#__codelineno-2-25></a>            <span class=k>if</span> <span class=n>txt</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=s1>&#39;&quot;v=spf1&#39;</span><span class=p>)</span> <span class=ow>or</span> <span class=n>txt</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=s1>&#39;v=spf1&#39;</span><span class=p>):</span>
</span><span id=__span-2-26><a id=__codelineno-2-26 name=__codelineno-2-26 href=#__codelineno-2-26></a>                <span class=n>results</span><span class=p>[</span><span class=s1>&#39;spf_includes&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>_parse_spf</span><span class=p>(</span><span class=n>txt</span><span class=p>)</span>
</span><span id=__span-2-27><a id=__codelineno-2-27 name=__codelineno-2-27 href=#__codelineno-2-27></a>                <span class=k>break</span>
</span><span id=__span-2-28><a id=__codelineno-2-28 name=__codelineno-2-28 href=#__codelineno-2-28></a>
</span><span id=__span-2-29><a id=__codelineno-2-29 name=__codelineno-2-29 href=#__codelineno-2-29></a>    <span class=k>return</span> <span class=n>results</span>
</span><span id=__span-2-30><a id=__codelineno-2-30 name=__codelineno-2-30 href=#__codelineno-2-30></a>
</span><span id=__span-2-31><a id=__codelineno-2-31 name=__codelineno-2-31 href=#__codelineno-2-31></a><span class=k>def</span><span class=w> </span><span class=nf>_parse_spf</span><span class=p>(</span><span class=n>spf_record</span><span class=p>):</span>
</span><span id=__span-2-32><a id=__codelineno-2-32 name=__codelineno-2-32 href=#__codelineno-2-32></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Extract included domains from SPF record&quot;&quot;&quot;</span>
</span><span id=__span-2-33><a id=__codelineno-2-33 name=__codelineno-2-33 href=#__codelineno-2-33></a>    <span class=n>includes</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-2-34><a id=__codelineno-2-34 name=__codelineno-2-34 href=#__codelineno-2-34></a>    <span class=n>parts</span> <span class=o>=</span> <span class=n>spf_record</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s1>&#39;&quot;&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>split</span><span class=p>()</span>
</span><span id=__span-2-35><a id=__codelineno-2-35 name=__codelineno-2-35 href=#__codelineno-2-35></a>    <span class=k>for</span> <span class=n>part</span> <span class=ow>in</span> <span class=n>parts</span><span class=p>:</span>
</span><span id=__span-2-36><a id=__codelineno-2-36 name=__codelineno-2-36 href=#__codelineno-2-36></a>        <span class=k>if</span> <span class=n>part</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=s1>&#39;include:&#39;</span><span class=p>)</span> <span class=ow>or</span> <span class=n>part</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=s1>&#39;redirect=&#39;</span><span class=p>):</span>
</span><span id=__span-2-37><a id=__codelineno-2-37 name=__codelineno-2-37 href=#__codelineno-2-37></a>            <span class=n>includes</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>part</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;:&#39;</span><span class=p>,</span> <span class=mi>1</span><span class=p>)[</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;=&#39;</span><span class=p>,</span> <span class=mi>1</span><span class=p>)[</span><span class=o>-</span><span class=mi>1</span><span class=p>])</span>
</span><span id=__span-2-38><a id=__codelineno-2-38 name=__codelineno-2-38 href=#__codelineno-2-38></a>    <span class=k>return</span> <span class=n>includes</span>
</span><span id=__span-2-39><a id=__codelineno-2-39 name=__codelineno-2-39 href=#__codelineno-2-39></a>
</span><span id=__span-2-40><a id=__codelineno-2-40 name=__codelineno-2-40 href=#__codelineno-2-40></a><span class=c1># Reverse DNS lookup</span>
</span><span id=__span-2-41><a id=__codelineno-2-41 name=__codelineno-2-41 href=#__codelineno-2-41></a><span class=k>def</span><span class=w> </span><span class=nf>reverse_dns</span><span class=p>(</span><span class=n>ip_address</span><span class=p>):</span>
</span><span id=__span-2-42><a id=__codelineno-2-42 name=__codelineno-2-42 href=#__codelineno-2-42></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Get hostname from IP address&quot;&quot;&quot;</span>
</span><span id=__span-2-43><a id=__codelineno-2-43 name=__codelineno-2-43 href=#__codelineno-2-43></a>    <span class=k>try</span><span class=p>:</span>
</span><span id=__span-2-44><a id=__codelineno-2-44 name=__codelineno-2-44 href=#__codelineno-2-44></a>        <span class=n>reversed_name</span> <span class=o>=</span> <span class=n>dns</span><span class=o>.</span><span class=n>reversename</span><span class=o>.</span><span class=n>from_address</span><span class=p>(</span><span class=n>ip_address</span><span class=p>)</span>
</span><span id=__span-2-45><a id=__codelineno-2-45 name=__codelineno-2-45 href=#__codelineno-2-45></a>        <span class=n>answer</span> <span class=o>=</span> <span class=n>dns</span><span class=o>.</span><span class=n>resolver</span><span class=o>.</span><span class=n>resolve</span><span class=p>(</span><span class=n>reversed_name</span><span class=p>,</span> <span class=s1>&#39;PTR&#39;</span><span class=p>)</span>
</span><span id=__span-2-46><a id=__codelineno-2-46 name=__codelineno-2-46 href=#__codelineno-2-46></a>        <span class=k>return</span> <span class=nb>str</span><span class=p>(</span><span class=n>answer</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
</span><span id=__span-2-47><a id=__codelineno-2-47 name=__codelineno-2-47 href=#__codelineno-2-47></a>    <span class=k>except</span> <span class=ne>Exception</span><span class=p>:</span>
</span><span id=__span-2-48><a id=__codelineno-2-48 name=__codelineno-2-48 href=#__codelineno-2-48></a>        <span class=k>return</span> <span class=kc>None</span>
</span></code></pre></div> <h3 id=certificate-transparency-analysis>Certificate Transparency Analysis<a class=headerlink href=#certificate-transparency-analysis title="Permanent link">&para;</a></h3> <p>Every TLS certificate issued by trusted Certificate Authorities (CAs) is logged to public Certificate Transparency (CT) logs. These logs are permanently searchable and reveal:</p> <ul> <li>All subdomains of a domain that have ever had certificates issued</li> <li>Historical certificate information even if the subdomain no longer exists</li> <li>Subject Alternative Names (SANs) — multiple domains covered by a single certificate</li> <li>Issuing CA and certificate validity periods</li> </ul> <p><strong>Primary tools</strong>: - <strong>crt.sh</strong>: Free web interface and API for CT log searching - <strong>Censys</strong>: Comprehensive certificate search with API access - <strong>certspotter</strong> (Spackle Lab): Certificate monitoring tool</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=kn>import</span><span class=w> </span><span class=nn>requests</span>
</span><span id=__span-3-2><a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a><span class=kn>import</span><span class=w> </span><span class=nn>json</span>
</span><span id=__span-3-3><a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a><span class=kn>from</span><span class=w> </span><span class=nn>datetime</span><span class=w> </span><span class=kn>import</span> <span class=n>datetime</span>
</span><span id=__span-3-4><a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a>
</span><span id=__span-3-5><a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a><span class=k>def</span><span class=w> </span><span class=nf>find_subdomains_via_crt</span><span class=p>(</span><span class=n>domain</span><span class=p>):</span>
</span><span id=__span-3-6><a id=__codelineno-3-6 name=__codelineno-3-6 href=#__codelineno-3-6></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Query crt.sh for certificates containing the domain&quot;&quot;&quot;</span>
</span><span id=__span-3-7><a id=__codelineno-3-7 name=__codelineno-3-7 href=#__codelineno-3-7></a>    <span class=n>url</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;https://crt.sh/?q=%.</span><span class=si>{</span><span class=n>domain</span><span class=si>}</span><span class=s2>&amp;output=json&quot;</span>
</span><span id=__span-3-8><a id=__codelineno-3-8 name=__codelineno-3-8 href=#__codelineno-3-8></a>
</span><span id=__span-3-9><a id=__codelineno-3-9 name=__codelineno-3-9 href=#__codelineno-3-9></a>    <span class=k>try</span><span class=p>:</span>
</span><span id=__span-3-10><a id=__codelineno-3-10 name=__codelineno-3-10 href=#__codelineno-3-10></a>        <span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>timeout</span><span class=o>=</span><span class=mi>30</span><span class=p>)</span>
</span><span id=__span-3-11><a id=__codelineno-3-11 name=__codelineno-3-11 href=#__codelineno-3-11></a>        <span class=n>data</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>json</span><span class=p>()</span>
</span><span id=__span-3-12><a id=__codelineno-3-12 name=__codelineno-3-12 href=#__codelineno-3-12></a>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-3-13><a id=__codelineno-3-13 name=__codelineno-3-13 href=#__codelineno-3-13></a>        <span class=k>return</span> <span class=p>{</span><span class=s1>&#39;error&#39;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)}</span>
</span><span id=__span-3-14><a id=__codelineno-3-14 name=__codelineno-3-14 href=#__codelineno-3-14></a>
</span><span id=__span-3-15><a id=__codelineno-3-15 name=__codelineno-3-15 href=#__codelineno-3-15></a>    <span class=n>subdomains</span> <span class=o>=</span> <span class=nb>set</span><span class=p>()</span>
</span><span id=__span-3-16><a id=__codelineno-3-16 name=__codelineno-3-16 href=#__codelineno-3-16></a>    <span class=n>certificates</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-3-17><a id=__codelineno-3-17 name=__codelineno-3-17 href=#__codelineno-3-17></a>
</span><span id=__span-3-18><a id=__codelineno-3-18 name=__codelineno-3-18 href=#__codelineno-3-18></a>    <span class=k>for</span> <span class=n>entry</span> <span class=ow>in</span> <span class=n>data</span><span class=p>:</span>
</span><span id=__span-3-19><a id=__codelineno-3-19 name=__codelineno-3-19 href=#__codelineno-3-19></a>        <span class=n>name_value</span> <span class=o>=</span> <span class=n>entry</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;name_value&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>)</span>
</span><span id=__span-3-20><a id=__codelineno-3-20 name=__codelineno-3-20 href=#__codelineno-3-20></a>        <span class=n>not_before</span> <span class=o>=</span> <span class=n>entry</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;not_before&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>)</span>
</span><span id=__span-3-21><a id=__codelineno-3-21 name=__codelineno-3-21 href=#__codelineno-3-21></a>        <span class=n>issuer</span> <span class=o>=</span> <span class=n>entry</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;issuer_name&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>)</span>
</span><span id=__span-3-22><a id=__codelineno-3-22 name=__codelineno-3-22 href=#__codelineno-3-22></a>
</span><span id=__span-3-23><a id=__codelineno-3-23 name=__codelineno-3-23 href=#__codelineno-3-23></a>        <span class=c1># Extract individual names from the certificate</span>
</span><span id=__span-3-24><a id=__codelineno-3-24 name=__codelineno-3-24 href=#__codelineno-3-24></a>        <span class=k>for</span> <span class=n>name</span> <span class=ow>in</span> <span class=n>name_value</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>):</span>
</span><span id=__span-3-25><a id=__codelineno-3-25 name=__codelineno-3-25 href=#__codelineno-3-25></a>            <span class=n>name</span> <span class=o>=</span> <span class=n>name</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>
</span><span id=__span-3-26><a id=__codelineno-3-26 name=__codelineno-3-26 href=#__codelineno-3-26></a>            <span class=k>if</span> <span class=n>name</span><span class=o>.</span><span class=n>endswith</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;.</span><span class=si>{</span><span class=n>domain</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>)</span> <span class=ow>or</span> <span class=n>name</span> <span class=o>==</span> <span class=n>domain</span><span class=p>:</span>
</span><span id=__span-3-27><a id=__codelineno-3-27 name=__codelineno-3-27 href=#__codelineno-3-27></a>                <span class=n>subdomains</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>name</span><span class=p>)</span>
</span><span id=__span-3-28><a id=__codelineno-3-28 name=__codelineno-3-28 href=#__codelineno-3-28></a>
</span><span id=__span-3-29><a id=__codelineno-3-29 name=__codelineno-3-29 href=#__codelineno-3-29></a>        <span class=n>certificates</span><span class=o>.</span><span class=n>append</span><span class=p>({</span>
</span><span id=__span-3-30><a id=__codelineno-3-30 name=__codelineno-3-30 href=#__codelineno-3-30></a>            <span class=s1>&#39;id&#39;</span><span class=p>:</span> <span class=n>entry</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;id&#39;</span><span class=p>),</span>
</span><span id=__span-3-31><a id=__codelineno-3-31 name=__codelineno-3-31 href=#__codelineno-3-31></a>            <span class=s1>&#39;logged_at&#39;</span><span class=p>:</span> <span class=n>entry</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;entry_timestamp&#39;</span><span class=p>),</span>
</span><span id=__span-3-32><a id=__codelineno-3-32 name=__codelineno-3-32 href=#__codelineno-3-32></a>            <span class=s1>&#39;not_before&#39;</span><span class=p>:</span> <span class=n>not_before</span><span class=p>,</span>
</span><span id=__span-3-33><a id=__codelineno-3-33 name=__codelineno-3-33 href=#__codelineno-3-33></a>            <span class=s1>&#39;common_name&#39;</span><span class=p>:</span> <span class=n>entry</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;common_name&#39;</span><span class=p>),</span>
</span><span id=__span-3-34><a id=__codelineno-3-34 name=__codelineno-3-34 href=#__codelineno-3-34></a>            <span class=s1>&#39;issuer&#39;</span><span class=p>:</span> <span class=n>issuer</span>
</span><span id=__span-3-35><a id=__codelineno-3-35 name=__codelineno-3-35 href=#__codelineno-3-35></a>        <span class=p>})</span>
</span><span id=__span-3-36><a id=__codelineno-3-36 name=__codelineno-3-36 href=#__codelineno-3-36></a>
</span><span id=__span-3-37><a id=__codelineno-3-37 name=__codelineno-3-37 href=#__codelineno-3-37></a>    <span class=k>return</span> <span class=p>{</span>
</span><span id=__span-3-38><a id=__codelineno-3-38 name=__codelineno-3-38 href=#__codelineno-3-38></a>        <span class=s1>&#39;domain&#39;</span><span class=p>:</span> <span class=n>domain</span><span class=p>,</span>
</span><span id=__span-3-39><a id=__codelineno-3-39 name=__codelineno-3-39 href=#__codelineno-3-39></a>        <span class=s1>&#39;unique_subdomains&#39;</span><span class=p>:</span> <span class=nb>sorted</span><span class=p>(</span><span class=nb>list</span><span class=p>(</span><span class=n>subdomains</span><span class=p>)),</span>
</span><span id=__span-3-40><a id=__codelineno-3-40 name=__codelineno-3-40 href=#__codelineno-3-40></a>        <span class=s1>&#39;certificate_count&#39;</span><span class=p>:</span> <span class=nb>len</span><span class=p>(</span><span class=n>certificates</span><span class=p>),</span>
</span><span id=__span-3-41><a id=__codelineno-3-41 name=__codelineno-3-41 href=#__codelineno-3-41></a>        <span class=s1>&#39;oldest_certificate&#39;</span><span class=p>:</span> <span class=nb>min</span><span class=p>(</span><span class=n>c</span><span class=p>[</span><span class=s1>&#39;not_before&#39;</span><span class=p>]</span> <span class=k>for</span> <span class=n>c</span> <span class=ow>in</span> <span class=n>certificates</span> <span class=k>if</span> <span class=n>c</span><span class=p>[</span><span class=s1>&#39;not_before&#39;</span><span class=p>]),</span>
</span><span id=__span-3-42><a id=__codelineno-3-42 name=__codelineno-3-42 href=#__codelineno-3-42></a>        <span class=s1>&#39;latest_certificate&#39;</span><span class=p>:</span> <span class=nb>max</span><span class=p>(</span><span class=n>c</span><span class=p>[</span><span class=s1>&#39;not_before&#39;</span><span class=p>]</span> <span class=k>for</span> <span class=n>c</span> <span class=ow>in</span> <span class=n>certificates</span> <span class=k>if</span> <span class=n>c</span><span class=p>[</span><span class=s1>&#39;not_before&#39;</span><span class=p>])</span>
</span><span id=__span-3-43><a id=__codelineno-3-43 name=__codelineno-3-43 href=#__codelineno-3-43></a>    <span class=p>}</span>
</span></code></pre></div> <hr> <h2 id=63-ip-address-intelligence>6.3 IP Address Intelligence<a class=headerlink href=#63-ip-address-intelligence title="Permanent link">&para;</a></h2> <h3 id=ip-whois-and-asn-research>IP WHOIS and ASN Research<a class=headerlink href=#ip-whois-and-asn-research title="Permanent link">&para;</a></h3> <p>Each block of IP addresses is allocated to an organization by a Regional Internet Registry (RIR). ARIN (North America), RIPE (Europe), APNIC (Asia-Pacific), AFRINIC (Africa), and LACNIC (Latin America) maintain publicly searchable allocation databases.</p> <p>Autonomous System Numbers (ASNs) identify organizations that control blocks of IP addresses. Large organizations have their own ASNs; smaller organizations are customers of ISPs that hold ASNs.</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=kn>import</span><span class=w> </span><span class=nn>requests</span>
</span><span id=__span-4-2><a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a>
</span><span id=__span-4-3><a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a><span class=k>def</span><span class=w> </span><span class=nf>ip_intelligence</span><span class=p>(</span><span class=n>ip_address</span><span class=p>):</span>
</span><span id=__span-4-4><a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Gather intelligence about an IP address&quot;&quot;&quot;</span>
</span><span id=__span-4-5><a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a>    <span class=n>results</span> <span class=o>=</span> <span class=p>{}</span>
</span><span id=__span-4-6><a id=__codelineno-4-6 name=__codelineno-4-6 href=#__codelineno-4-6></a>
</span><span id=__span-4-7><a id=__codelineno-4-7 name=__codelineno-4-7 href=#__codelineno-4-7></a>    <span class=c1># IPInfo.io — geolocation and ASN data</span>
</span><span id=__span-4-8><a id=__codelineno-4-8 name=__codelineno-4-8 href=#__codelineno-4-8></a>    <span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;https://ipinfo.io/</span><span class=si>{</span><span class=n>ip_address</span><span class=si>}</span><span class=s2>/json&quot;</span><span class=p>)</span>
</span><span id=__span-4-9><a id=__codelineno-4-9 name=__codelineno-4-9 href=#__codelineno-4-9></a>    <span class=k>if</span> <span class=n>response</span><span class=o>.</span><span class=n>status_code</span> <span class=o>==</span> <span class=mi>200</span><span class=p>:</span>
</span><span id=__span-4-10><a id=__codelineno-4-10 name=__codelineno-4-10 href=#__codelineno-4-10></a>        <span class=n>ipinfo</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>json</span><span class=p>()</span>
</span><span id=__span-4-11><a id=__codelineno-4-11 name=__codelineno-4-11 href=#__codelineno-4-11></a>        <span class=n>results</span><span class=p>[</span><span class=s1>&#39;geolocation&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-4-12><a id=__codelineno-4-12 name=__codelineno-4-12 href=#__codelineno-4-12></a>            <span class=s1>&#39;country&#39;</span><span class=p>:</span> <span class=n>ipinfo</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;country&#39;</span><span class=p>),</span>
</span><span id=__span-4-13><a id=__codelineno-4-13 name=__codelineno-4-13 href=#__codelineno-4-13></a>            <span class=s1>&#39;region&#39;</span><span class=p>:</span> <span class=n>ipinfo</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;region&#39;</span><span class=p>),</span>
</span><span id=__span-4-14><a id=__codelineno-4-14 name=__codelineno-4-14 href=#__codelineno-4-14></a>            <span class=s1>&#39;city&#39;</span><span class=p>:</span> <span class=n>ipinfo</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;city&#39;</span><span class=p>),</span>
</span><span id=__span-4-15><a id=__codelineno-4-15 name=__codelineno-4-15 href=#__codelineno-4-15></a>            <span class=s1>&#39;org&#39;</span><span class=p>:</span> <span class=n>ipinfo</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;org&#39;</span><span class=p>),</span>  <span class=c1># ASN and org name</span>
</span><span id=__span-4-16><a id=__codelineno-4-16 name=__codelineno-4-16 href=#__codelineno-4-16></a>            <span class=s1>&#39;hostname&#39;</span><span class=p>:</span> <span class=n>ipinfo</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;hostname&#39;</span><span class=p>),</span>
</span><span id=__span-4-17><a id=__codelineno-4-17 name=__codelineno-4-17 href=#__codelineno-4-17></a>        <span class=p>}</span>
</span><span id=__span-4-18><a id=__codelineno-4-18 name=__codelineno-4-18 href=#__codelineno-4-18></a>
</span><span id=__span-4-19><a id=__codelineno-4-19 name=__codelineno-4-19 href=#__codelineno-4-19></a>    <span class=c1># RIPE WHOIS lookup</span>
</span><span id=__span-4-20><a id=__codelineno-4-20 name=__codelineno-4-20 href=#__codelineno-4-20></a>    <span class=n>ripe_response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span>
</span><span id=__span-4-21><a id=__codelineno-4-21 name=__codelineno-4-21 href=#__codelineno-4-21></a>        <span class=sa>f</span><span class=s2>&quot;https://rest.db.ripe.net/search.json?query-string=</span><span class=si>{</span><span class=n>ip_address</span><span class=si>}</span><span class=s2>&amp;type-filter=inetnum&quot;</span>
</span><span id=__span-4-22><a id=__codelineno-4-22 name=__codelineno-4-22 href=#__codelineno-4-22></a>    <span class=p>)</span>
</span><span id=__span-4-23><a id=__codelineno-4-23 name=__codelineno-4-23 href=#__codelineno-4-23></a>    <span class=k>if</span> <span class=n>ripe_response</span><span class=o>.</span><span class=n>status_code</span> <span class=o>==</span> <span class=mi>200</span><span class=p>:</span>
</span><span id=__span-4-24><a id=__codelineno-4-24 name=__codelineno-4-24 href=#__codelineno-4-24></a>        <span class=n>results</span><span class=p>[</span><span class=s1>&#39;ripe_data&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>ripe_response</span><span class=o>.</span><span class=n>json</span><span class=p>()</span>
</span><span id=__span-4-25><a id=__codelineno-4-25 name=__codelineno-4-25 href=#__codelineno-4-25></a>
</span><span id=__span-4-26><a id=__codelineno-4-26 name=__codelineno-4-26 href=#__codelineno-4-26></a>    <span class=k>return</span> <span class=n>results</span>
</span><span id=__span-4-27><a id=__codelineno-4-27 name=__codelineno-4-27 href=#__codelineno-4-27></a>
</span><span id=__span-4-28><a id=__codelineno-4-28 name=__codelineno-4-28 href=#__codelineno-4-28></a><span class=k>def</span><span class=w> </span><span class=nf>asn_lookup</span><span class=p>(</span><span class=n>asn</span><span class=p>):</span>
</span><span id=__span-4-29><a id=__codelineno-4-29 name=__codelineno-4-29 href=#__codelineno-4-29></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Look up organization controlling an ASN&quot;&quot;&quot;</span>
</span><span id=__span-4-30><a id=__codelineno-4-30 name=__codelineno-4-30 href=#__codelineno-4-30></a>    <span class=c1># BGPView API — free, good coverage</span>
</span><span id=__span-4-31><a id=__codelineno-4-31 name=__codelineno-4-31 href=#__codelineno-4-31></a>    <span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;https://api.bgpview.io/asn/</span><span class=si>{</span><span class=n>asn</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-4-32><a id=__codelineno-4-32 name=__codelineno-4-32 href=#__codelineno-4-32></a>    <span class=k>if</span> <span class=n>response</span><span class=o>.</span><span class=n>status_code</span> <span class=o>==</span> <span class=mi>200</span><span class=p>:</span>
</span><span id=__span-4-33><a id=__codelineno-4-33 name=__codelineno-4-33 href=#__codelineno-4-33></a>        <span class=n>data</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>json</span><span class=p>()[</span><span class=s1>&#39;data&#39;</span><span class=p>]</span>
</span><span id=__span-4-34><a id=__codelineno-4-34 name=__codelineno-4-34 href=#__codelineno-4-34></a>        <span class=k>return</span> <span class=p>{</span>
</span><span id=__span-4-35><a id=__codelineno-4-35 name=__codelineno-4-35 href=#__codelineno-4-35></a>            <span class=s1>&#39;asn&#39;</span><span class=p>:</span> <span class=n>asn</span><span class=p>,</span>
</span><span id=__span-4-36><a id=__codelineno-4-36 name=__codelineno-4-36 href=#__codelineno-4-36></a>            <span class=s1>&#39;name&#39;</span><span class=p>:</span> <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;name&#39;</span><span class=p>),</span>
</span><span id=__span-4-37><a id=__codelineno-4-37 name=__codelineno-4-37 href=#__codelineno-4-37></a>            <span class=s1>&#39;description&#39;</span><span class=p>:</span> <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;description&#39;</span><span class=p>),</span>
</span><span id=__span-4-38><a id=__codelineno-4-38 name=__codelineno-4-38 href=#__codelineno-4-38></a>            <span class=s1>&#39;country&#39;</span><span class=p>:</span> <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;country_code&#39;</span><span class=p>),</span>
</span><span id=__span-4-39><a id=__codelineno-4-39 name=__codelineno-4-39 href=#__codelineno-4-39></a>            <span class=s1>&#39;website&#39;</span><span class=p>:</span> <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;website&#39;</span><span class=p>),</span>
</span><span id=__span-4-40><a id=__codelineno-4-40 name=__codelineno-4-40 href=#__codelineno-4-40></a>            <span class=s1>&#39;prefixes_ipv4&#39;</span><span class=p>:</span> <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;rir_allocation&#39;</span><span class=p>,</span> <span class=p>{})</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;prefix&#39;</span><span class=p>),</span>
</span><span id=__span-4-41><a id=__codelineno-4-41 name=__codelineno-4-41 href=#__codelineno-4-41></a>        <span class=p>}</span>
</span></code></pre></div> <h3 id=passive-dns>Passive DNS<a class=headerlink href=#passive-dns title="Permanent link">&para;</a></h3> <p>Passive DNS databases record historical DNS resolutions — which domains have resolved to which IP addresses over time. This is enormously valuable for:</p> <ul> <li>Tracing domain/IP relationships across time</li> <li>Identifying domains that shared infrastructure with a target domain</li> <li>Pivoting from a known malicious IP to other domains hosted there</li> <li>Reconstructing historical infrastructure that has since changed</li> </ul> <p><strong>Commercial Passive DNS services</strong>: - <strong>SecurityTrails</strong>: Comprehensive passive DNS with API access - <strong>RiskIQ PassiveTotal</strong> (now Microsoft Defender): Enterprise passive DNS, particularly strong for threat intelligence - <strong>Farsight DNSDB</strong>: Research-grade passive DNS with academic and commercial access tiers - <strong>VirusTotal</strong>: Includes passive DNS data alongside malware intelligence</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=kn>import</span><span class=w> </span><span class=nn>requests</span>
</span><span id=__span-5-2><a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a>
</span><span id=__span-5-3><a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a><span class=k>class</span><span class=w> </span><span class=nc>SecurityTrailsAPI</span><span class=p>:</span>
</span><span id=__span-5-4><a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;SecurityTrails API client for passive DNS research&quot;&quot;&quot;</span>
</span><span id=__span-5-5><a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a>
</span><span id=__span-5-6><a id=__codelineno-5-6 name=__codelineno-5-6 href=#__codelineno-5-6></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>api_key</span><span class=p>):</span>
</span><span id=__span-5-7><a id=__codelineno-5-7 name=__codelineno-5-7 href=#__codelineno-5-7></a>        <span class=bp>self</span><span class=o>.</span><span class=n>api_key</span> <span class=o>=</span> <span class=n>api_key</span>
</span><span id=__span-5-8><a id=__codelineno-5-8 name=__codelineno-5-8 href=#__codelineno-5-8></a>        <span class=bp>self</span><span class=o>.</span><span class=n>base_url</span> <span class=o>=</span> <span class=s2>&quot;https://api.securitytrails.com/v1&quot;</span>
</span><span id=__span-5-9><a id=__codelineno-5-9 name=__codelineno-5-9 href=#__codelineno-5-9></a>        <span class=bp>self</span><span class=o>.</span><span class=n>headers</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&quot;apikey&quot;</span><span class=p>:</span> <span class=n>api_key</span><span class=p>,</span> <span class=s2>&quot;Content-Type&quot;</span><span class=p>:</span> <span class=s2>&quot;application/json&quot;</span><span class=p>}</span>
</span><span id=__span-5-10><a id=__codelineno-5-10 name=__codelineno-5-10 href=#__codelineno-5-10></a>
</span><span id=__span-5-11><a id=__codelineno-5-11 name=__codelineno-5-11 href=#__codelineno-5-11></a>    <span class=k>def</span><span class=w> </span><span class=nf>get_domain_history</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>domain</span><span class=p>):</span>
</span><span id=__span-5-12><a id=__codelineno-5-12 name=__codelineno-5-12 href=#__codelineno-5-12></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Get DNS resolution history for a domain&quot;&quot;&quot;</span>
</span><span id=__span-5-13><a id=__codelineno-5-13 name=__codelineno-5-13 href=#__codelineno-5-13></a>        <span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span>
</span><span id=__span-5-14><a id=__codelineno-5-14 name=__codelineno-5-14 href=#__codelineno-5-14></a>            <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>base_url</span><span class=si>}</span><span class=s2>/history/</span><span class=si>{</span><span class=n>domain</span><span class=si>}</span><span class=s2>/dns/a&quot;</span><span class=p>,</span>
</span><span id=__span-5-15><a id=__codelineno-5-15 name=__codelineno-5-15 href=#__codelineno-5-15></a>            <span class=n>headers</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>headers</span>
</span><span id=__span-5-16><a id=__codelineno-5-16 name=__codelineno-5-16 href=#__codelineno-5-16></a>        <span class=p>)</span>
</span><span id=__span-5-17><a id=__codelineno-5-17 name=__codelineno-5-17 href=#__codelineno-5-17></a>        <span class=k>return</span> <span class=n>response</span><span class=o>.</span><span class=n>json</span><span class=p>()</span>
</span><span id=__span-5-18><a id=__codelineno-5-18 name=__codelineno-5-18 href=#__codelineno-5-18></a>
</span><span id=__span-5-19><a id=__codelineno-5-19 name=__codelineno-5-19 href=#__codelineno-5-19></a>    <span class=k>def</span><span class=w> </span><span class=nf>get_ip_history</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>ip</span><span class=p>):</span>
</span><span id=__span-5-20><a id=__codelineno-5-20 name=__codelineno-5-20 href=#__codelineno-5-20></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Get domains that have resolved to an IP&quot;&quot;&quot;</span>
</span><span id=__span-5-21><a id=__codelineno-5-21 name=__codelineno-5-21 href=#__codelineno-5-21></a>        <span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span>
</span><span id=__span-5-22><a id=__codelineno-5-22 name=__codelineno-5-22 href=#__codelineno-5-22></a>            <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>base_url</span><span class=si>}</span><span class=s2>/ips/nearby/</span><span class=si>{</span><span class=n>ip</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
</span><span id=__span-5-23><a id=__codelineno-5-23 name=__codelineno-5-23 href=#__codelineno-5-23></a>            <span class=n>headers</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>headers</span>
</span><span id=__span-5-24><a id=__codelineno-5-24 name=__codelineno-5-24 href=#__codelineno-5-24></a>        <span class=p>)</span>
</span><span id=__span-5-25><a id=__codelineno-5-25 name=__codelineno-5-25 href=#__codelineno-5-25></a>        <span class=k>return</span> <span class=n>response</span><span class=o>.</span><span class=n>json</span><span class=p>()</span>
</span><span id=__span-5-26><a id=__codelineno-5-26 name=__codelineno-5-26 href=#__codelineno-5-26></a>
</span><span id=__span-5-27><a id=__codelineno-5-27 name=__codelineno-5-27 href=#__codelineno-5-27></a>    <span class=k>def</span><span class=w> </span><span class=nf>get_subdomains</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>domain</span><span class=p>):</span>
</span><span id=__span-5-28><a id=__codelineno-5-28 name=__codelineno-5-28 href=#__codelineno-5-28></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Get all subdomains for a domain&quot;&quot;&quot;</span>
</span><span id=__span-5-29><a id=__codelineno-5-29 name=__codelineno-5-29 href=#__codelineno-5-29></a>        <span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span>
</span><span id=__span-5-30><a id=__codelineno-5-30 name=__codelineno-5-30 href=#__codelineno-5-30></a>            <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>base_url</span><span class=si>}</span><span class=s2>/domain/</span><span class=si>{</span><span class=n>domain</span><span class=si>}</span><span class=s2>/subdomains&quot;</span><span class=p>,</span>
</span><span id=__span-5-31><a id=__codelineno-5-31 name=__codelineno-5-31 href=#__codelineno-5-31></a>            <span class=n>headers</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>headers</span>
</span><span id=__span-5-32><a id=__codelineno-5-32 name=__codelineno-5-32 href=#__codelineno-5-32></a>        <span class=p>)</span>
</span><span id=__span-5-33><a id=__codelineno-5-33 name=__codelineno-5-33 href=#__codelineno-5-33></a>        <span class=k>return</span> <span class=n>response</span><span class=o>.</span><span class=n>json</span><span class=p>()</span>
</span><span id=__span-5-34><a id=__codelineno-5-34 name=__codelineno-5-34 href=#__codelineno-5-34></a>
</span><span id=__span-5-35><a id=__codelineno-5-35 name=__codelineno-5-35 href=#__codelineno-5-35></a>    <span class=k>def</span><span class=w> </span><span class=nf>search_by_keyword</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>keyword</span><span class=p>,</span> <span class=n>field</span><span class=o>=</span><span class=s2>&quot;whois_email&quot;</span><span class=p>):</span>
</span><span id=__span-5-36><a id=__codelineno-5-36 name=__codelineno-5-36 href=#__codelineno-5-36></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Search for domains by WHOIS field content&quot;&quot;&quot;</span>
</span><span id=__span-5-37><a id=__codelineno-5-37 name=__codelineno-5-37 href=#__codelineno-5-37></a>        <span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span>
</span><span id=__span-5-38><a id=__codelineno-5-38 name=__codelineno-5-38 href=#__codelineno-5-38></a>            <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>base_url</span><span class=si>}</span><span class=s2>/domains/list&quot;</span><span class=p>,</span>
</span><span id=__span-5-39><a id=__codelineno-5-39 name=__codelineno-5-39 href=#__codelineno-5-39></a>            <span class=n>headers</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>headers</span><span class=p>,</span>
</span><span id=__span-5-40><a id=__codelineno-5-40 name=__codelineno-5-40 href=#__codelineno-5-40></a>            <span class=n>json</span><span class=o>=</span><span class=p>{</span>
</span><span id=__span-5-41><a id=__codelineno-5-41 name=__codelineno-5-41 href=#__codelineno-5-41></a>                <span class=s2>&quot;filter&quot;</span><span class=p>:</span> <span class=p>{</span><span class=n>field</span><span class=p>:</span> <span class=n>keyword</span><span class=p>},</span>
</span><span id=__span-5-42><a id=__codelineno-5-42 name=__codelineno-5-42 href=#__codelineno-5-42></a>                <span class=s2>&quot;include_ips&quot;</span><span class=p>:</span> <span class=kc>False</span>
</span><span id=__span-5-43><a id=__codelineno-5-43 name=__codelineno-5-43 href=#__codelineno-5-43></a>            <span class=p>}</span>
</span><span id=__span-5-44><a id=__codelineno-5-44 name=__codelineno-5-44 href=#__codelineno-5-44></a>        <span class=p>)</span>
</span><span id=__span-5-45><a id=__codelineno-5-45 name=__codelineno-5-45 href=#__codelineno-5-45></a>        <span class=k>return</span> <span class=n>response</span><span class=o>.</span><span class=n>json</span><span class=p>()</span>
</span></code></pre></div> <hr> <h2 id=64-shodan-censys-and-internet-scanning-databases>6.4 Shodan, Censys, and Internet Scanning Databases<a class=headerlink href=#64-shodan-censys-and-internet-scanning-databases title="Permanent link">&para;</a></h2> <p>The internet-wide scanning databases represent one of the most powerful tools in the technical OSINT arsenal. These services continuously scan the entire IPv4 address space (and portions of IPv6) and index what they find.</p> <h3 id=shodan>Shodan<a class=headerlink href=#shodan title="Permanent link">&para;</a></h3> <p>Shodan is the most well-known internet scanning database. It connects to every device exposed to the internet and records what it responds with — HTTP banners, SSH version information, TLS certificates, industrial control system protocols, and more.</p> <p><strong>What Shodan reveals</strong>: - Web servers and their software versions - Industrial control systems (SCADA, HMI devices) - Network devices (routers, switches, cameras) - Databases exposed to the internet - IoT devices of all types - Configuration information from banner responses - TLS certificate chains</p> <p><strong>Shodan search operators</strong>:</p> <div class="language-text highlight"><pre><span></span><code><span id=__span-6-1><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a># Basic domain search
</span><span id=__span-6-2><a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a>hostname:example.com
</span><span id=__span-6-3><a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a>
</span><span id=__span-6-4><a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a># Search by ASN
</span><span id=__span-6-5><a id=__codelineno-6-5 name=__codelineno-6-5 href=#__codelineno-6-5></a>asn:AS12345
</span><span id=__span-6-6><a id=__codelineno-6-6 name=__codelineno-6-6 href=#__codelineno-6-6></a>
</span><span id=__span-6-7><a id=__codelineno-6-7 name=__codelineno-6-7 href=#__codelineno-6-7></a># Find exposed databases
</span><span id=__span-6-8><a id=__codelineno-6-8 name=__codelineno-6-8 href=#__codelineno-6-8></a>product:mongodb country:US
</span><span id=__span-6-9><a id=__codelineno-6-9 name=__codelineno-6-9 href=#__codelineno-6-9></a>
</span><span id=__span-6-10><a id=__codelineno-6-10 name=__codelineno-6-10 href=#__codelineno-6-10></a># Find industrial control systems
</span><span id=__span-6-11><a id=__codelineno-6-11 name=__codelineno-6-11 href=#__codelineno-6-11></a>tag:ics country:US
</span><span id=__span-6-12><a id=__codelineno-6-12 name=__codelineno-6-12 href=#__codelineno-6-12></a>
</span><span id=__span-6-13><a id=__codelineno-6-13 name=__codelineno-6-13 href=#__codelineno-6-13></a># Find specific banners
</span><span id=__span-6-14><a id=__codelineno-6-14 name=__codelineno-6-14 href=#__codelineno-6-14></a>&quot;Server: Apache/2.4&quot; country:DE
</span><span id=__span-6-15><a id=__codelineno-6-15 name=__codelineno-6-15 href=#__codelineno-6-15></a>
</span><span id=__span-6-16><a id=__codelineno-6-16 name=__codelineno-6-16 href=#__codelineno-6-16></a># Find devices with specific vulnerabilities
</span><span id=__span-6-17><a id=__codelineno-6-17 name=__codelineno-6-17 href=#__codelineno-6-17></a>vuln:CVE-2021-44228 (Log4Shell)
</span><span id=__span-6-18><a id=__codelineno-6-18 name=__codelineno-6-18 href=#__codelineno-6-18></a>
</span><span id=__span-6-19><a id=__codelineno-6-19 name=__codelineno-6-19 href=#__codelineno-6-19></a># Combine filters
</span><span id=__span-6-20><a id=__codelineno-6-20 name=__codelineno-6-20 href=#__codelineno-6-20></a>org:&quot;Target Corporation&quot; port:8080 http.title:&quot;Admin&quot;
</span></code></pre></div> <p><strong>Python Shodan API</strong>:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-7-1><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=kn>import</span><span class=w> </span><span class=nn>shodan</span>
</span><span id=__span-7-2><a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a>
</span><span id=__span-7-3><a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a><span class=n>api</span> <span class=o>=</span> <span class=n>shodan</span><span class=o>.</span><span class=n>Shodan</span><span class=p>(</span><span class=s1>&#39;YOUR_API_KEY&#39;</span><span class=p>)</span>
</span><span id=__span-7-4><a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a>
</span><span id=__span-7-5><a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a><span class=k>def</span><span class=w> </span><span class=nf>scan_organization</span><span class=p>(</span><span class=n>query</span><span class=p>):</span>
</span><span id=__span-7-6><a id=__codelineno-7-6 name=__codelineno-7-6 href=#__codelineno-7-6></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Collect Shodan results for an organization&quot;&quot;&quot;</span>
</span><span id=__span-7-7><a id=__codelineno-7-7 name=__codelineno-7-7 href=#__codelineno-7-7></a>    <span class=n>results_list</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-7-8><a id=__codelineno-7-8 name=__codelineno-7-8 href=#__codelineno-7-8></a>
</span><span id=__span-7-9><a id=__codelineno-7-9 name=__codelineno-7-9 href=#__codelineno-7-9></a>    <span class=k>try</span><span class=p>:</span>
</span><span id=__span-7-10><a id=__codelineno-7-10 name=__codelineno-7-10 href=#__codelineno-7-10></a>        <span class=c1># Search Shodan</span>
</span><span id=__span-7-11><a id=__codelineno-7-11 name=__codelineno-7-11 href=#__codelineno-7-11></a>        <span class=n>results</span> <span class=o>=</span> <span class=n>api</span><span class=o>.</span><span class=n>search</span><span class=p>(</span><span class=n>query</span><span class=p>,</span> <span class=n>limit</span><span class=o>=</span><span class=mi>1000</span><span class=p>)</span>
</span><span id=__span-7-12><a id=__codelineno-7-12 name=__codelineno-7-12 href=#__codelineno-7-12></a>
</span><span id=__span-7-13><a id=__codelineno-7-13 name=__codelineno-7-13 href=#__codelineno-7-13></a>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Total results: </span><span class=si>{</span><span class=n>results</span><span class=p>[</span><span class=s1>&#39;total&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-7-14><a id=__codelineno-7-14 name=__codelineno-7-14 href=#__codelineno-7-14></a>
</span><span id=__span-7-15><a id=__codelineno-7-15 name=__codelineno-7-15 href=#__codelineno-7-15></a>        <span class=k>for</span> <span class=n>result</span> <span class=ow>in</span> <span class=n>results</span><span class=p>[</span><span class=s1>&#39;matches&#39;</span><span class=p>]:</span>
</span><span id=__span-7-16><a id=__codelineno-7-16 name=__codelineno-7-16 href=#__codelineno-7-16></a>            <span class=n>entry</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-7-17><a id=__codelineno-7-17 name=__codelineno-7-17 href=#__codelineno-7-17></a>                <span class=s1>&#39;ip&#39;</span><span class=p>:</span> <span class=n>result</span><span class=p>[</span><span class=s1>&#39;ip_str&#39;</span><span class=p>],</span>
</span><span id=__span-7-18><a id=__codelineno-7-18 name=__codelineno-7-18 href=#__codelineno-7-18></a>                <span class=s1>&#39;port&#39;</span><span class=p>:</span> <span class=n>result</span><span class=p>[</span><span class=s1>&#39;port&#39;</span><span class=p>],</span>
</span><span id=__span-7-19><a id=__codelineno-7-19 name=__codelineno-7-19 href=#__codelineno-7-19></a>                <span class=s1>&#39;transport&#39;</span><span class=p>:</span> <span class=n>result</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;transport&#39;</span><span class=p>,</span> <span class=s1>&#39;tcp&#39;</span><span class=p>),</span>
</span><span id=__span-7-20><a id=__codelineno-7-20 name=__codelineno-7-20 href=#__codelineno-7-20></a>                <span class=s1>&#39;hostnames&#39;</span><span class=p>:</span> <span class=n>result</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;hostnames&#39;</span><span class=p>,</span> <span class=p>[]),</span>
</span><span id=__span-7-21><a id=__codelineno-7-21 name=__codelineno-7-21 href=#__codelineno-7-21></a>                <span class=s1>&#39;org&#39;</span><span class=p>:</span> <span class=n>result</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;org&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>),</span>
</span><span id=__span-7-22><a id=__codelineno-7-22 name=__codelineno-7-22 href=#__codelineno-7-22></a>                <span class=s1>&#39;isp&#39;</span><span class=p>:</span> <span class=n>result</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;isp&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>),</span>
</span><span id=__span-7-23><a id=__codelineno-7-23 name=__codelineno-7-23 href=#__codelineno-7-23></a>                <span class=s1>&#39;country&#39;</span><span class=p>:</span> <span class=n>result</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;location&#39;</span><span class=p>,</span> <span class=p>{})</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;country_name&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>),</span>
</span><span id=__span-7-24><a id=__codelineno-7-24 name=__codelineno-7-24 href=#__codelineno-7-24></a>                <span class=s1>&#39;city&#39;</span><span class=p>:</span> <span class=n>result</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;location&#39;</span><span class=p>,</span> <span class=p>{})</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;city&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>),</span>
</span><span id=__span-7-25><a id=__codelineno-7-25 name=__codelineno-7-25 href=#__codelineno-7-25></a>                <span class=s1>&#39;last_update&#39;</span><span class=p>:</span> <span class=n>result</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;timestamp&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>),</span>
</span><span id=__span-7-26><a id=__codelineno-7-26 name=__codelineno-7-26 href=#__codelineno-7-26></a>                <span class=s1>&#39;banner&#39;</span><span class=p>:</span> <span class=n>result</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;data&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>)[:</span><span class=mi>500</span><span class=p>],</span>  <span class=c1># Truncate long banners</span>
</span><span id=__span-7-27><a id=__codelineno-7-27 name=__codelineno-7-27 href=#__codelineno-7-27></a>                <span class=s1>&#39;product&#39;</span><span class=p>:</span> <span class=n>result</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;product&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>),</span>
</span><span id=__span-7-28><a id=__codelineno-7-28 name=__codelineno-7-28 href=#__codelineno-7-28></a>                <span class=s1>&#39;version&#39;</span><span class=p>:</span> <span class=n>result</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;version&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>),</span>
</span><span id=__span-7-29><a id=__codelineno-7-29 name=__codelineno-7-29 href=#__codelineno-7-29></a>                <span class=s1>&#39;cpes&#39;</span><span class=p>:</span> <span class=n>result</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;cpe&#39;</span><span class=p>,</span> <span class=p>[]),</span>
</span><span id=__span-7-30><a id=__codelineno-7-30 name=__codelineno-7-30 href=#__codelineno-7-30></a>                <span class=s1>&#39;vulns&#39;</span><span class=p>:</span> <span class=nb>list</span><span class=p>(</span><span class=n>result</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;vulns&#39;</span><span class=p>,</span> <span class=p>{})</span><span class=o>.</span><span class=n>keys</span><span class=p>()),</span>
</span><span id=__span-7-31><a id=__codelineno-7-31 name=__codelineno-7-31 href=#__codelineno-7-31></a>            <span class=p>}</span>
</span><span id=__span-7-32><a id=__codelineno-7-32 name=__codelineno-7-32 href=#__codelineno-7-32></a>
</span><span id=__span-7-33><a id=__codelineno-7-33 name=__codelineno-7-33 href=#__codelineno-7-33></a>            <span class=c1># Extract HTTP-specific data</span>
</span><span id=__span-7-34><a id=__codelineno-7-34 name=__codelineno-7-34 href=#__codelineno-7-34></a>            <span class=k>if</span> <span class=s1>&#39;http&#39;</span> <span class=ow>in</span> <span class=n>result</span><span class=p>:</span>
</span><span id=__span-7-35><a id=__codelineno-7-35 name=__codelineno-7-35 href=#__codelineno-7-35></a>                <span class=n>entry</span><span class=p>[</span><span class=s1>&#39;http_title&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>result</span><span class=p>[</span><span class=s1>&#39;http&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;title&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>)</span>
</span><span id=__span-7-36><a id=__codelineno-7-36 name=__codelineno-7-36 href=#__codelineno-7-36></a>                <span class=n>entry</span><span class=p>[</span><span class=s1>&#39;http_server&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>result</span><span class=p>[</span><span class=s1>&#39;http&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;server&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>)</span>
</span><span id=__span-7-37><a id=__codelineno-7-37 name=__codelineno-7-37 href=#__codelineno-7-37></a>                <span class=n>entry</span><span class=p>[</span><span class=s1>&#39;http_status&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>result</span><span class=p>[</span><span class=s1>&#39;http&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;status&#39;</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
</span><span id=__span-7-38><a id=__codelineno-7-38 name=__codelineno-7-38 href=#__codelineno-7-38></a>
</span><span id=__span-7-39><a id=__codelineno-7-39 name=__codelineno-7-39 href=#__codelineno-7-39></a>            <span class=c1># Extract SSL certificate info</span>
</span><span id=__span-7-40><a id=__codelineno-7-40 name=__codelineno-7-40 href=#__codelineno-7-40></a>            <span class=k>if</span> <span class=s1>&#39;ssl&#39;</span> <span class=ow>in</span> <span class=n>result</span><span class=p>:</span>
</span><span id=__span-7-41><a id=__codelineno-7-41 name=__codelineno-7-41 href=#__codelineno-7-41></a>                <span class=n>cert</span> <span class=o>=</span> <span class=n>result</span><span class=p>[</span><span class=s1>&#39;ssl&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;cert&#39;</span><span class=p>,</span> <span class=p>{})</span>
</span><span id=__span-7-42><a id=__codelineno-7-42 name=__codelineno-7-42 href=#__codelineno-7-42></a>                <span class=n>subject</span> <span class=o>=</span> <span class=n>cert</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;subject&#39;</span><span class=p>,</span> <span class=p>{})</span>
</span><span id=__span-7-43><a id=__codelineno-7-43 name=__codelineno-7-43 href=#__codelineno-7-43></a>                <span class=n>entry</span><span class=p>[</span><span class=s1>&#39;ssl_cn&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>subject</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;CN&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>)</span>
</span><span id=__span-7-44><a id=__codelineno-7-44 name=__codelineno-7-44 href=#__codelineno-7-44></a>                <span class=n>entry</span><span class=p>[</span><span class=s1>&#39;ssl_org&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>subject</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;O&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>)</span>
</span><span id=__span-7-45><a id=__codelineno-7-45 name=__codelineno-7-45 href=#__codelineno-7-45></a>                <span class=n>entry</span><span class=p>[</span><span class=s1>&#39;ssl_expires&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>cert</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;expires&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>))</span>
</span><span id=__span-7-46><a id=__codelineno-7-46 name=__codelineno-7-46 href=#__codelineno-7-46></a>
</span><span id=__span-7-47><a id=__codelineno-7-47 name=__codelineno-7-47 href=#__codelineno-7-47></a>            <span class=n>results_list</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>entry</span><span class=p>)</span>
</span><span id=__span-7-48><a id=__codelineno-7-48 name=__codelineno-7-48 href=#__codelineno-7-48></a>
</span><span id=__span-7-49><a id=__codelineno-7-49 name=__codelineno-7-49 href=#__codelineno-7-49></a>    <span class=k>except</span> <span class=n>shodan</span><span class=o>.</span><span class=n>APIError</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-7-50><a id=__codelineno-7-50 name=__codelineno-7-50 href=#__codelineno-7-50></a>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Shodan error: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-7-51><a id=__codelineno-7-51 name=__codelineno-7-51 href=#__codelineno-7-51></a>
</span><span id=__span-7-52><a id=__codelineno-7-52 name=__codelineno-7-52 href=#__codelineno-7-52></a>    <span class=k>return</span> <span class=n>results_list</span>
</span><span id=__span-7-53><a id=__codelineno-7-53 name=__codelineno-7-53 href=#__codelineno-7-53></a>
</span><span id=__span-7-54><a id=__codelineno-7-54 name=__codelineno-7-54 href=#__codelineno-7-54></a><span class=c1># Search for organization&#39;s infrastructure</span>
</span><span id=__span-7-55><a id=__codelineno-7-55 name=__codelineno-7-55 href=#__codelineno-7-55></a><span class=n>results</span> <span class=o>=</span> <span class=n>scan_organization</span><span class=p>(</span><span class=s1>&#39;org:&quot;Target Company Name&quot;&#39;</span><span class=p>)</span>
</span></code></pre></div> <h3 id=censys>Censys<a class=headerlink href=#censys title="Permanent link">&para;</a></h3> <p>Censys provides similar internet-wide scanning data with a stronger focus on TLS certificates and a research-oriented API.</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-8-1><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=kn>from</span><span class=w> </span><span class=nn>censys.search</span><span class=w> </span><span class=kn>import</span> <span class=n>CensysHosts</span>
</span><span id=__span-8-2><a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a><span class=kn>from</span><span class=w> </span><span class=nn>censys.common.exceptions</span><span class=w> </span><span class=kn>import</span> <span class=n>CensysRateLimitExceededException</span>
</span><span id=__span-8-3><a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a>
</span><span id=__span-8-4><a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a><span class=k>def</span><span class=w> </span><span class=nf>censys_host_search</span><span class=p>(</span><span class=n>query</span><span class=p>,</span> <span class=n>fields</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
</span><span id=__span-8-5><a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Search Censys hosts database&quot;&quot;&quot;</span>
</span><span id=__span-8-6><a id=__codelineno-8-6 name=__codelineno-8-6 href=#__codelineno-8-6></a>    <span class=n>h</span> <span class=o>=</span> <span class=n>CensysHosts</span><span class=p>()</span>
</span><span id=__span-8-7><a id=__codelineno-8-7 name=__codelineno-8-7 href=#__codelineno-8-7></a>
</span><span id=__span-8-8><a id=__codelineno-8-8 name=__codelineno-8-8 href=#__codelineno-8-8></a>    <span class=n>default_fields</span> <span class=o>=</span> <span class=p>[</span>
</span><span id=__span-8-9><a id=__codelineno-8-9 name=__codelineno-8-9 href=#__codelineno-8-9></a>        <span class=s2>&quot;ip&quot;</span><span class=p>,</span> <span class=s2>&quot;services.port&quot;</span><span class=p>,</span> <span class=s2>&quot;services.transport_protocol&quot;</span><span class=p>,</span>
</span><span id=__span-8-10><a id=__codelineno-8-10 name=__codelineno-8-10 href=#__codelineno-8-10></a>        <span class=s2>&quot;services.service_name&quot;</span><span class=p>,</span> <span class=s2>&quot;services.banner&quot;</span><span class=p>,</span>
</span><span id=__span-8-11><a id=__codelineno-8-11 name=__codelineno-8-11 href=#__codelineno-8-11></a>        <span class=s2>&quot;services.tls.certificate.parsed.subject.common_name&quot;</span><span class=p>,</span>
</span><span id=__span-8-12><a id=__codelineno-8-12 name=__codelineno-8-12 href=#__codelineno-8-12></a>        <span class=s2>&quot;autonomous_system.name&quot;</span><span class=p>,</span> <span class=s2>&quot;location.country&quot;</span>
</span><span id=__span-8-13><a id=__codelineno-8-13 name=__codelineno-8-13 href=#__codelineno-8-13></a>    <span class=p>]</span>
</span><span id=__span-8-14><a id=__codelineno-8-14 name=__codelineno-8-14 href=#__codelineno-8-14></a>
</span><span id=__span-8-15><a id=__codelineno-8-15 name=__codelineno-8-15 href=#__codelineno-8-15></a>    <span class=k>try</span><span class=p>:</span>
</span><span id=__span-8-16><a id=__codelineno-8-16 name=__codelineno-8-16 href=#__codelineno-8-16></a>        <span class=n>results</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-8-17><a id=__codelineno-8-17 name=__codelineno-8-17 href=#__codelineno-8-17></a>        <span class=k>for</span> <span class=n>page</span> <span class=ow>in</span> <span class=n>h</span><span class=o>.</span><span class=n>search</span><span class=p>(</span><span class=n>query</span><span class=p>,</span> <span class=n>fields</span><span class=o>=</span><span class=n>fields</span> <span class=ow>or</span> <span class=n>default_fields</span><span class=p>,</span> <span class=n>pages</span><span class=o>=</span><span class=mi>5</span><span class=p>):</span>
</span><span id=__span-8-18><a id=__codelineno-8-18 name=__codelineno-8-18 href=#__codelineno-8-18></a>            <span class=n>results</span><span class=o>.</span><span class=n>extend</span><span class=p>(</span><span class=n>page</span><span class=p>)</span>
</span><span id=__span-8-19><a id=__codelineno-8-19 name=__codelineno-8-19 href=#__codelineno-8-19></a>        <span class=k>return</span> <span class=n>results</span>
</span><span id=__span-8-20><a id=__codelineno-8-20 name=__codelineno-8-20 href=#__codelineno-8-20></a>    <span class=k>except</span> <span class=n>CensysRateLimitExceededException</span><span class=p>:</span>
</span><span id=__span-8-21><a id=__codelineno-8-21 name=__codelineno-8-21 href=#__codelineno-8-21></a>        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Rate limit exceeded, implement backoff&quot;</span><span class=p>)</span>
</span><span id=__span-8-22><a id=__codelineno-8-22 name=__codelineno-8-22 href=#__codelineno-8-22></a>        <span class=k>return</span> <span class=p>[]</span>
</span></code></pre></div> <hr> <h2 id=65-subdomain-enumeration>6.5 Subdomain Enumeration<a class=headerlink href=#65-subdomain-enumeration title="Permanent link">&para;</a></h2> <p>Discovering all subdomains of a target domain reveals the full scope of an organization's web presence and often reveals forgotten, unsecured, or development infrastructure.</p> <h3 id=passive-subdomain-discovery>Passive Subdomain Discovery<a class=headerlink href=#passive-subdomain-discovery title="Permanent link">&para;</a></h3> <p>Passive methods collect subdomains without directly querying target infrastructure:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-9-1><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=kn>import</span><span class=w> </span><span class=nn>requests</span>
</span><span id=__span-9-2><a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a><span class=kn>from</span><span class=w> </span><span class=nn>concurrent.futures</span><span class=w> </span><span class=kn>import</span> <span class=n>ThreadPoolExecutor</span><span class=p>,</span> <span class=n>as_completed</span>
</span><span id=__span-9-3><a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a>
</span><span id=__span-9-4><a id=__codelineno-9-4 name=__codelineno-9-4 href=#__codelineno-9-4></a><span class=k>def</span><span class=w> </span><span class=nf>passive_subdomain_discovery</span><span class=p>(</span><span class=n>domain</span><span class=p>):</span>
</span><span id=__span-9-5><a id=__codelineno-9-5 name=__codelineno-9-5 href=#__codelineno-9-5></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Aggregate subdomain data from multiple passive sources&quot;&quot;&quot;</span>
</span><span id=__span-9-6><a id=__codelineno-9-6 name=__codelineno-9-6 href=#__codelineno-9-6></a>    <span class=n>subdomains</span> <span class=o>=</span> <span class=nb>set</span><span class=p>()</span>
</span><span id=__span-9-7><a id=__codelineno-9-7 name=__codelineno-9-7 href=#__codelineno-9-7></a>
</span><span id=__span-9-8><a id=__codelineno-9-8 name=__codelineno-9-8 href=#__codelineno-9-8></a>    <span class=c1># Source 1: Certificate Transparency</span>
</span><span id=__span-9-9><a id=__codelineno-9-9 name=__codelineno-9-9 href=#__codelineno-9-9></a>    <span class=k>try</span><span class=p>:</span>
</span><span id=__span-9-10><a id=__codelineno-9-10 name=__codelineno-9-10 href=#__codelineno-9-10></a>        <span class=n>crt_data</span> <span class=o>=</span> <span class=n>find_subdomains_via_crt</span><span class=p>(</span><span class=n>domain</span><span class=p>)</span>  <span class=c1># From earlier in chapter</span>
</span><span id=__span-9-11><a id=__codelineno-9-11 name=__codelineno-9-11 href=#__codelineno-9-11></a>        <span class=n>subdomains</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>crt_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;unique_subdomains&#39;</span><span class=p>,</span> <span class=p>[]))</span>
</span><span id=__span-9-12><a id=__codelineno-9-12 name=__codelineno-9-12 href=#__codelineno-9-12></a>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-9-13><a id=__codelineno-9-13 name=__codelineno-9-13 href=#__codelineno-9-13></a>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;CRT.sh error: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-9-14><a id=__codelineno-9-14 name=__codelineno-9-14 href=#__codelineno-9-14></a>
</span><span id=__span-9-15><a id=__codelineno-9-15 name=__codelineno-9-15 href=#__codelineno-9-15></a>    <span class=c1># Source 2: SecurityTrails (if API key available)</span>
</span><span id=__span-9-16><a id=__codelineno-9-16 name=__codelineno-9-16 href=#__codelineno-9-16></a>    <span class=c1># subdomains.update(securitytrails.get_subdomains(domain))</span>
</span><span id=__span-9-17><a id=__codelineno-9-17 name=__codelineno-9-17 href=#__codelineno-9-17></a>
</span><span id=__span-9-18><a id=__codelineno-9-18 name=__codelineno-9-18 href=#__codelineno-9-18></a>    <span class=c1># Source 3: VirusTotal</span>
</span><span id=__span-9-19><a id=__codelineno-9-19 name=__codelineno-9-19 href=#__codelineno-9-19></a>    <span class=k>try</span><span class=p>:</span>
</span><span id=__span-9-20><a id=__codelineno-9-20 name=__codelineno-9-20 href=#__codelineno-9-20></a>        <span class=n>vt_url</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;https://www.virustotal.com/api/v3/domains/</span><span class=si>{</span><span class=n>domain</span><span class=si>}</span><span class=s2>/subdomains&quot;</span>
</span><span id=__span-9-21><a id=__codelineno-9-21 name=__codelineno-9-21 href=#__codelineno-9-21></a>        <span class=n>headers</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&quot;x-apikey&quot;</span><span class=p>:</span> <span class=s2>&quot;YOUR_VT_API_KEY&quot;</span><span class=p>}</span>
</span><span id=__span-9-22><a id=__codelineno-9-22 name=__codelineno-9-22 href=#__codelineno-9-22></a>        <span class=n>vt_response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>vt_url</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=n>headers</span><span class=p>)</span>
</span><span id=__span-9-23><a id=__codelineno-9-23 name=__codelineno-9-23 href=#__codelineno-9-23></a>        <span class=k>if</span> <span class=n>vt_response</span><span class=o>.</span><span class=n>status_code</span> <span class=o>==</span> <span class=mi>200</span><span class=p>:</span>
</span><span id=__span-9-24><a id=__codelineno-9-24 name=__codelineno-9-24 href=#__codelineno-9-24></a>            <span class=n>vt_data</span> <span class=o>=</span> <span class=n>vt_response</span><span class=o>.</span><span class=n>json</span><span class=p>()</span>
</span><span id=__span-9-25><a id=__codelineno-9-25 name=__codelineno-9-25 href=#__codelineno-9-25></a>            <span class=k>for</span> <span class=n>sub</span> <span class=ow>in</span> <span class=n>vt_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;data&#39;</span><span class=p>,</span> <span class=p>[]):</span>
</span><span id=__span-9-26><a id=__codelineno-9-26 name=__codelineno-9-26 href=#__codelineno-9-26></a>                <span class=n>subdomains</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>sub</span><span class=p>[</span><span class=s1>&#39;id&#39;</span><span class=p>])</span>
</span><span id=__span-9-27><a id=__codelineno-9-27 name=__codelineno-9-27 href=#__codelineno-9-27></a>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-9-28><a id=__codelineno-9-28 name=__codelineno-9-28 href=#__codelineno-9-28></a>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;VirusTotal error: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-9-29><a id=__codelineno-9-29 name=__codelineno-9-29 href=#__codelineno-9-29></a>
</span><span id=__span-9-30><a id=__codelineno-9-30 name=__codelineno-9-30 href=#__codelineno-9-30></a>    <span class=c1># Source 4: HackerTarget</span>
</span><span id=__span-9-31><a id=__codelineno-9-31 name=__codelineno-9-31 href=#__codelineno-9-31></a>    <span class=k>try</span><span class=p>:</span>
</span><span id=__span-9-32><a id=__codelineno-9-32 name=__codelineno-9-32 href=#__codelineno-9-32></a>        <span class=n>ht_response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span>
</span><span id=__span-9-33><a id=__codelineno-9-33 name=__codelineno-9-33 href=#__codelineno-9-33></a>            <span class=sa>f</span><span class=s2>&quot;https://api.hackertarget.com/hostsearch/?q=</span><span class=si>{</span><span class=n>domain</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-9-34><a id=__codelineno-9-34 name=__codelineno-9-34 href=#__codelineno-9-34></a>        <span class=p>)</span>
</span><span id=__span-9-35><a id=__codelineno-9-35 name=__codelineno-9-35 href=#__codelineno-9-35></a>        <span class=k>for</span> <span class=n>line</span> <span class=ow>in</span> <span class=n>ht_response</span><span class=o>.</span><span class=n>text</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>):</span>
</span><span id=__span-9-36><a id=__codelineno-9-36 name=__codelineno-9-36 href=#__codelineno-9-36></a>            <span class=k>if</span> <span class=s1>&#39;,&#39;</span> <span class=ow>in</span> <span class=n>line</span><span class=p>:</span>
</span><span id=__span-9-37><a id=__codelineno-9-37 name=__codelineno-9-37 href=#__codelineno-9-37></a>                <span class=n>subdomain</span> <span class=o>=</span> <span class=n>line</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;,&#39;</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>
</span><span id=__span-9-38><a id=__codelineno-9-38 name=__codelineno-9-38 href=#__codelineno-9-38></a>                <span class=k>if</span> <span class=n>subdomain</span><span class=o>.</span><span class=n>endswith</span><span class=p>(</span><span class=n>domain</span><span class=p>):</span>
</span><span id=__span-9-39><a id=__codelineno-9-39 name=__codelineno-9-39 href=#__codelineno-9-39></a>                    <span class=n>subdomains</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>subdomain</span><span class=p>)</span>
</span><span id=__span-9-40><a id=__codelineno-9-40 name=__codelineno-9-40 href=#__codelineno-9-40></a>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-9-41><a id=__codelineno-9-41 name=__codelineno-9-41 href=#__codelineno-9-41></a>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;HackerTarget error: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-9-42><a id=__codelineno-9-42 name=__codelineno-9-42 href=#__codelineno-9-42></a>
</span><span id=__span-9-43><a id=__codelineno-9-43 name=__codelineno-9-43 href=#__codelineno-9-43></a>    <span class=k>return</span> <span class=nb>sorted</span><span class=p>(</span><span class=nb>list</span><span class=p>(</span><span class=n>subdomains</span><span class=p>))</span>
</span><span id=__span-9-44><a id=__codelineno-9-44 name=__codelineno-9-44 href=#__codelineno-9-44></a>
</span><span id=__span-9-45><a id=__codelineno-9-45 name=__codelineno-9-45 href=#__codelineno-9-45></a><span class=k>def</span><span class=w> </span><span class=nf>resolve_subdomains</span><span class=p>(</span><span class=n>subdomains</span><span class=p>):</span>
</span><span id=__span-9-46><a id=__codelineno-9-46 name=__codelineno-9-46 href=#__codelineno-9-46></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Resolve discovered subdomains to IP addresses&quot;&quot;&quot;</span>
</span><span id=__span-9-47><a id=__codelineno-9-47 name=__codelineno-9-47 href=#__codelineno-9-47></a>    <span class=kn>import</span><span class=w> </span><span class=nn>dns.resolver</span>
</span><span id=__span-9-48><a id=__codelineno-9-48 name=__codelineno-9-48 href=#__codelineno-9-48></a>
</span><span id=__span-9-49><a id=__codelineno-9-49 name=__codelineno-9-49 href=#__codelineno-9-49></a>    <span class=n>resolver</span> <span class=o>=</span> <span class=n>dns</span><span class=o>.</span><span class=n>resolver</span><span class=o>.</span><span class=n>Resolver</span><span class=p>()</span>
</span><span id=__span-9-50><a id=__codelineno-9-50 name=__codelineno-9-50 href=#__codelineno-9-50></a>    <span class=n>resolver</span><span class=o>.</span><span class=n>timeout</span> <span class=o>=</span> <span class=mi>3</span>
</span><span id=__span-9-51><a id=__codelineno-9-51 name=__codelineno-9-51 href=#__codelineno-9-51></a>    <span class=n>results</span> <span class=o>=</span> <span class=p>{}</span>
</span><span id=__span-9-52><a id=__codelineno-9-52 name=__codelineno-9-52 href=#__codelineno-9-52></a>
</span><span id=__span-9-53><a id=__codelineno-9-53 name=__codelineno-9-53 href=#__codelineno-9-53></a>    <span class=k>def</span><span class=w> </span><span class=nf>resolve_single</span><span class=p>(</span><span class=n>subdomain</span><span class=p>):</span>
</span><span id=__span-9-54><a id=__codelineno-9-54 name=__codelineno-9-54 href=#__codelineno-9-54></a>        <span class=k>try</span><span class=p>:</span>
</span><span id=__span-9-55><a id=__codelineno-9-55 name=__codelineno-9-55 href=#__codelineno-9-55></a>            <span class=n>answers</span> <span class=o>=</span> <span class=n>resolver</span><span class=o>.</span><span class=n>resolve</span><span class=p>(</span><span class=n>subdomain</span><span class=p>,</span> <span class=s1>&#39;A&#39;</span><span class=p>)</span>
</span><span id=__span-9-56><a id=__codelineno-9-56 name=__codelineno-9-56 href=#__codelineno-9-56></a>            <span class=k>return</span> <span class=n>subdomain</span><span class=p>,</span> <span class=p>[</span><span class=nb>str</span><span class=p>(</span><span class=n>r</span><span class=p>)</span> <span class=k>for</span> <span class=n>r</span> <span class=ow>in</span> <span class=n>answers</span><span class=p>]</span>
</span><span id=__span-9-57><a id=__codelineno-9-57 name=__codelineno-9-57 href=#__codelineno-9-57></a>        <span class=k>except</span> <span class=ne>Exception</span><span class=p>:</span>
</span><span id=__span-9-58><a id=__codelineno-9-58 name=__codelineno-9-58 href=#__codelineno-9-58></a>            <span class=k>return</span> <span class=n>subdomain</span><span class=p>,</span> <span class=p>[]</span>
</span><span id=__span-9-59><a id=__codelineno-9-59 name=__codelineno-9-59 href=#__codelineno-9-59></a>
</span><span id=__span-9-60><a id=__codelineno-9-60 name=__codelineno-9-60 href=#__codelineno-9-60></a>    <span class=k>with</span> <span class=n>ThreadPoolExecutor</span><span class=p>(</span><span class=n>max_workers</span><span class=o>=</span><span class=mi>50</span><span class=p>)</span> <span class=k>as</span> <span class=n>executor</span><span class=p>:</span>
</span><span id=__span-9-61><a id=__codelineno-9-61 name=__codelineno-9-61 href=#__codelineno-9-61></a>        <span class=n>futures</span> <span class=o>=</span> <span class=p>{</span><span class=n>executor</span><span class=o>.</span><span class=n>submit</span><span class=p>(</span><span class=n>resolve_single</span><span class=p>,</span> <span class=n>sub</span><span class=p>):</span> <span class=n>sub</span> <span class=k>for</span> <span class=n>sub</span> <span class=ow>in</span> <span class=n>subdomains</span><span class=p>}</span>
</span><span id=__span-9-62><a id=__codelineno-9-62 name=__codelineno-9-62 href=#__codelineno-9-62></a>        <span class=k>for</span> <span class=n>future</span> <span class=ow>in</span> <span class=n>as_completed</span><span class=p>(</span><span class=n>futures</span><span class=p>):</span>
</span><span id=__span-9-63><a id=__codelineno-9-63 name=__codelineno-9-63 href=#__codelineno-9-63></a>            <span class=n>subdomain</span><span class=p>,</span> <span class=n>ips</span> <span class=o>=</span> <span class=n>future</span><span class=o>.</span><span class=n>result</span><span class=p>()</span>
</span><span id=__span-9-64><a id=__codelineno-9-64 name=__codelineno-9-64 href=#__codelineno-9-64></a>            <span class=k>if</span> <span class=n>ips</span><span class=p>:</span>
</span><span id=__span-9-65><a id=__codelineno-9-65 name=__codelineno-9-65 href=#__codelineno-9-65></a>                <span class=n>results</span><span class=p>[</span><span class=n>subdomain</span><span class=p>]</span> <span class=o>=</span> <span class=n>ips</span>
</span><span id=__span-9-66><a id=__codelineno-9-66 name=__codelineno-9-66 href=#__codelineno-9-66></a>
</span><span id=__span-9-67><a id=__codelineno-9-67 name=__codelineno-9-67 href=#__codelineno-9-67></a>    <span class=k>return</span> <span class=n>results</span>
</span></code></pre></div> <hr> <h2 id=66-email-infrastructure-analysis>6.6 Email Infrastructure Analysis<a class=headerlink href=#66-email-infrastructure-analysis title="Permanent link">&para;</a></h2> <p>An organization's email infrastructure reveals hosting decisions, security posture, and sometimes organizational structure.</p> <h3 id=mx-record-analysis>MX Record Analysis<a class=headerlink href=#mx-record-analysis title="Permanent link">&para;</a></h3> <p>MX records identify which mail servers receive email for a domain:</p> <ul> <li><strong>Google Workspace</strong>: MX records pointing to <code>aspmx.l.google.com</code> and similar indicate Google-hosted email</li> <li><strong>Microsoft 365</strong>: MX records containing <code>protection.outlook.com</code> indicate Microsoft-hosted email</li> <li><strong>Proofpoint, Mimecast, Barracuda</strong>: Email security gateways visible in MX records</li> <li><strong>Self-hosted</strong>: Custom MX records pointing to the organization's own infrastructure</li> </ul> <h3 id=spf-analysis>SPF Analysis<a class=headerlink href=#spf-analysis title="Permanent link">&para;</a></h3> <p>SPF records enumerate which servers are authorized to send email as the domain. Analyzing <code>include:</code> statements reveals which third-party services the organization uses for email sending:</p> <ul> <li>Marketing platforms (Mailchimp's SPF include: <code>_spf.mcsv.net</code>)</li> <li>CRM platforms (Salesforce: <code>_spf.salesforce.com</code>)</li> <li>Transactional email services (SendGrid, Mailgun)</li> <li>Internal relay servers</li> </ul> <h3 id=dmarc-analysis>DMARC Analysis<a class=headerlink href=#dmarc-analysis title="Permanent link">&para;</a></h3> <p>DMARC records reveal email authentication policy: - <code>p=none</code> — monitoring only, no enforcement (weak posture) - <code>p=quarantine</code> — suspicious mail goes to spam - <code>p=reject</code> — strict enforcement, unauthorized mail rejected - Missing DMARC entirely — weakest possible posture</p> <p>This reveals security sophistication and susceptibility to email spoofing.</p> <hr> <h2 id=67-building-automated-recon-pipelines>6.7 Building Automated Recon Pipelines<a class=headerlink href=#67-building-automated-recon-pipelines title="Permanent link">&para;</a></h2> <p>Professional-grade reconnaissance combines multiple sources into automated pipelines:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-10-1><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class=kn>import</span><span class=w> </span><span class=nn>asyncio</span>
</span><span id=__span-10-2><a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a><span class=kn>import</span><span class=w> </span><span class=nn>aiohttp</span>
</span><span id=__span-10-3><a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a><span class=kn>import</span><span class=w> </span><span class=nn>json</span>
</span><span id=__span-10-4><a id=__codelineno-10-4 name=__codelineno-10-4 href=#__codelineno-10-4></a><span class=kn>from</span><span class=w> </span><span class=nn>dataclasses</span><span class=w> </span><span class=kn>import</span> <span class=n>dataclass</span><span class=p>,</span> <span class=n>field</span>
</span><span id=__span-10-5><a id=__codelineno-10-5 name=__codelineno-10-5 href=#__codelineno-10-5></a><span class=kn>from</span><span class=w> </span><span class=nn>typing</span><span class=w> </span><span class=kn>import</span> <span class=n>List</span><span class=p>,</span> <span class=n>Dict</span>
</span><span id=__span-10-6><a id=__codelineno-10-6 name=__codelineno-10-6 href=#__codelineno-10-6></a>
</span><span id=__span-10-7><a id=__codelineno-10-7 name=__codelineno-10-7 href=#__codelineno-10-7></a><span class=nd>@dataclass</span>
</span><span id=__span-10-8><a id=__codelineno-10-8 name=__codelineno-10-8 href=#__codelineno-10-8></a><span class=k>class</span><span class=w> </span><span class=nc>DomainIntelReport</span><span class=p>:</span>
</span><span id=__span-10-9><a id=__codelineno-10-9 name=__codelineno-10-9 href=#__codelineno-10-9></a>    <span class=n>domain</span><span class=p>:</span> <span class=nb>str</span>
</span><span id=__span-10-10><a id=__codelineno-10-10 name=__codelineno-10-10 href=#__codelineno-10-10></a>    <span class=n>whois</span><span class=p>:</span> <span class=n>Dict</span> <span class=o>=</span> <span class=n>field</span><span class=p>(</span><span class=n>default_factory</span><span class=o>=</span><span class=nb>dict</span><span class=p>)</span>
</span><span id=__span-10-11><a id=__codelineno-10-11 name=__codelineno-10-11 href=#__codelineno-10-11></a>    <span class=n>dns_records</span><span class=p>:</span> <span class=n>Dict</span> <span class=o>=</span> <span class=n>field</span><span class=p>(</span><span class=n>default_factory</span><span class=o>=</span><span class=nb>dict</span><span class=p>)</span>
</span><span id=__span-10-12><a id=__codelineno-10-12 name=__codelineno-10-12 href=#__codelineno-10-12></a>    <span class=n>subdomains</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=n>field</span><span class=p>(</span><span class=n>default_factory</span><span class=o>=</span><span class=nb>list</span><span class=p>)</span>
</span><span id=__span-10-13><a id=__codelineno-10-13 name=__codelineno-10-13 href=#__codelineno-10-13></a>    <span class=n>certificates</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>]</span> <span class=o>=</span> <span class=n>field</span><span class=p>(</span><span class=n>default_factory</span><span class=o>=</span><span class=nb>list</span><span class=p>)</span>
</span><span id=__span-10-14><a id=__codelineno-10-14 name=__codelineno-10-14 href=#__codelineno-10-14></a>    <span class=n>shodan_results</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>]</span> <span class=o>=</span> <span class=n>field</span><span class=p>(</span><span class=n>default_factory</span><span class=o>=</span><span class=nb>list</span><span class=p>)</span>
</span><span id=__span-10-15><a id=__codelineno-10-15 name=__codelineno-10-15 href=#__codelineno-10-15></a>    <span class=n>related_domains</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=n>field</span><span class=p>(</span><span class=n>default_factory</span><span class=o>=</span><span class=nb>list</span><span class=p>)</span>
</span><span id=__span-10-16><a id=__codelineno-10-16 name=__codelineno-10-16 href=#__codelineno-10-16></a>    <span class=n>ip_addresses</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=n>field</span><span class=p>(</span><span class=n>default_factory</span><span class=o>=</span><span class=nb>list</span><span class=p>)</span>
</span><span id=__span-10-17><a id=__codelineno-10-17 name=__codelineno-10-17 href=#__codelineno-10-17></a>    <span class=n>analysis_timestamp</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span>
</span><span id=__span-10-18><a id=__codelineno-10-18 name=__codelineno-10-18 href=#__codelineno-10-18></a>
</span><span id=__span-10-19><a id=__codelineno-10-19 name=__codelineno-10-19 href=#__codelineno-10-19></a><span class=k>class</span><span class=w> </span><span class=nc>DomainReconPipeline</span><span class=p>:</span>
</span><span id=__span-10-20><a id=__codelineno-10-20 name=__codelineno-10-20 href=#__codelineno-10-20></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Automated domain reconnaissance pipeline&quot;&quot;&quot;</span>
</span><span id=__span-10-21><a id=__codelineno-10-21 name=__codelineno-10-21 href=#__codelineno-10-21></a>
</span><span id=__span-10-22><a id=__codelineno-10-22 name=__codelineno-10-22 href=#__codelineno-10-22></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>shodan_key</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>securitytrails_key</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
</span><span id=__span-10-23><a id=__codelineno-10-23 name=__codelineno-10-23 href=#__codelineno-10-23></a>        <span class=bp>self</span><span class=o>.</span><span class=n>shodan_key</span> <span class=o>=</span> <span class=n>shodan_key</span>
</span><span id=__span-10-24><a id=__codelineno-10-24 name=__codelineno-10-24 href=#__codelineno-10-24></a>        <span class=bp>self</span><span class=o>.</span><span class=n>st_key</span> <span class=o>=</span> <span class=n>securitytrails_key</span>
</span><span id=__span-10-25><a id=__codelineno-10-25 name=__codelineno-10-25 href=#__codelineno-10-25></a>
</span><span id=__span-10-26><a id=__codelineno-10-26 name=__codelineno-10-26 href=#__codelineno-10-26></a>    <span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>run_full_recon</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>domain</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>DomainIntelReport</span><span class=p>:</span>
</span><span id=__span-10-27><a id=__codelineno-10-27 name=__codelineno-10-27 href=#__codelineno-10-27></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Execute full reconnaissance pipeline for a domain&quot;&quot;&quot;</span>
</span><span id=__span-10-28><a id=__codelineno-10-28 name=__codelineno-10-28 href=#__codelineno-10-28></a>        <span class=kn>from</span><span class=w> </span><span class=nn>datetime</span><span class=w> </span><span class=kn>import</span> <span class=n>datetime</span>
</span><span id=__span-10-29><a id=__codelineno-10-29 name=__codelineno-10-29 href=#__codelineno-10-29></a>
</span><span id=__span-10-30><a id=__codelineno-10-30 name=__codelineno-10-30 href=#__codelineno-10-30></a>        <span class=n>report</span> <span class=o>=</span> <span class=n>DomainIntelReport</span><span class=p>(</span>
</span><span id=__span-10-31><a id=__codelineno-10-31 name=__codelineno-10-31 href=#__codelineno-10-31></a>            <span class=n>domain</span><span class=o>=</span><span class=n>domain</span><span class=p>,</span>
</span><span id=__span-10-32><a id=__codelineno-10-32 name=__codelineno-10-32 href=#__codelineno-10-32></a>            <span class=n>analysis_timestamp</span><span class=o>=</span><span class=n>datetime</span><span class=o>.</span><span class=n>utcnow</span><span class=p>()</span><span class=o>.</span><span class=n>isoformat</span><span class=p>()</span>
</span><span id=__span-10-33><a id=__codelineno-10-33 name=__codelineno-10-33 href=#__codelineno-10-33></a>        <span class=p>)</span>
</span><span id=__span-10-34><a id=__codelineno-10-34 name=__codelineno-10-34 href=#__codelineno-10-34></a>
</span><span id=__span-10-35><a id=__codelineno-10-35 name=__codelineno-10-35 href=#__codelineno-10-35></a>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;[*] Starting reconnaissance for </span><span class=si>{</span><span class=n>domain</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-10-36><a id=__codelineno-10-36 name=__codelineno-10-36 href=#__codelineno-10-36></a>
</span><span id=__span-10-37><a id=__codelineno-10-37 name=__codelineno-10-37 href=#__codelineno-10-37></a>        <span class=c1># Phase 1: WHOIS</span>
</span><span id=__span-10-38><a id=__codelineno-10-38 name=__codelineno-10-38 href=#__codelineno-10-38></a>        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;[*] Collecting WHOIS data...&quot;</span><span class=p>)</span>
</span><span id=__span-10-39><a id=__codelineno-10-39 name=__codelineno-10-39 href=#__codelineno-10-39></a>        <span class=n>report</span><span class=o>.</span><span class=n>whois</span> <span class=o>=</span> <span class=n>analyze_domain_whois</span><span class=p>(</span><span class=n>domain</span><span class=p>)</span>
</span><span id=__span-10-40><a id=__codelineno-10-40 name=__codelineno-10-40 href=#__codelineno-10-40></a>
</span><span id=__span-10-41><a id=__codelineno-10-41 name=__codelineno-10-41 href=#__codelineno-10-41></a>        <span class=c1># Phase 2: DNS</span>
</span><span id=__span-10-42><a id=__codelineno-10-42 name=__codelineno-10-42 href=#__codelineno-10-42></a>        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;[*] Collecting DNS records...&quot;</span><span class=p>)</span>
</span><span id=__span-10-43><a id=__codelineno-10-43 name=__codelineno-10-43 href=#__codelineno-10-43></a>        <span class=n>report</span><span class=o>.</span><span class=n>dns_records</span> <span class=o>=</span> <span class=n>full_dns_analysis</span><span class=p>(</span><span class=n>domain</span><span class=p>)</span>
</span><span id=__span-10-44><a id=__codelineno-10-44 name=__codelineno-10-44 href=#__codelineno-10-44></a>
</span><span id=__span-10-45><a id=__codelineno-10-45 name=__codelineno-10-45 href=#__codelineno-10-45></a>        <span class=c1># Extract IP addresses from A records</span>
</span><span id=__span-10-46><a id=__codelineno-10-46 name=__codelineno-10-46 href=#__codelineno-10-46></a>        <span class=k>if</span> <span class=n>report</span><span class=o>.</span><span class=n>dns_records</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;A&#39;</span><span class=p>):</span>
</span><span id=__span-10-47><a id=__codelineno-10-47 name=__codelineno-10-47 href=#__codelineno-10-47></a>            <span class=n>report</span><span class=o>.</span><span class=n>ip_addresses</span> <span class=o>=</span> <span class=n>report</span><span class=o>.</span><span class=n>dns_records</span><span class=p>[</span><span class=s1>&#39;A&#39;</span><span class=p>]</span>
</span><span id=__span-10-48><a id=__codelineno-10-48 name=__codelineno-10-48 href=#__codelineno-10-48></a>
</span><span id=__span-10-49><a id=__codelineno-10-49 name=__codelineno-10-49 href=#__codelineno-10-49></a>        <span class=c1># Phase 3: Certificate transparency</span>
</span><span id=__span-10-50><a id=__codelineno-10-50 name=__codelineno-10-50 href=#__codelineno-10-50></a>        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;[*] Querying certificate transparency...&quot;</span><span class=p>)</span>
</span><span id=__span-10-51><a id=__codelineno-10-51 name=__codelineno-10-51 href=#__codelineno-10-51></a>        <span class=n>crt_data</span> <span class=o>=</span> <span class=n>find_subdomains_via_crt</span><span class=p>(</span><span class=n>domain</span><span class=p>)</span>
</span><span id=__span-10-52><a id=__codelineno-10-52 name=__codelineno-10-52 href=#__codelineno-10-52></a>        <span class=n>report</span><span class=o>.</span><span class=n>subdomains</span> <span class=o>=</span> <span class=n>crt_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;unique_subdomains&#39;</span><span class=p>,</span> <span class=p>[])</span>
</span><span id=__span-10-53><a id=__codelineno-10-53 name=__codelineno-10-53 href=#__codelineno-10-53></a>        <span class=n>report</span><span class=o>.</span><span class=n>certificates</span> <span class=o>=</span> <span class=n>crt_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;certificates&#39;</span><span class=p>,</span> <span class=p>[])</span>
</span><span id=__span-10-54><a id=__codelineno-10-54 name=__codelineno-10-54 href=#__codelineno-10-54></a>
</span><span id=__span-10-55><a id=__codelineno-10-55 name=__codelineno-10-55 href=#__codelineno-10-55></a>        <span class=c1># Phase 4: Resolve subdomains</span>
</span><span id=__span-10-56><a id=__codelineno-10-56 name=__codelineno-10-56 href=#__codelineno-10-56></a>        <span class=k>if</span> <span class=n>report</span><span class=o>.</span><span class=n>subdomains</span><span class=p>:</span>
</span><span id=__span-10-57><a id=__codelineno-10-57 name=__codelineno-10-57 href=#__codelineno-10-57></a>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;[*] Resolving </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>report</span><span class=o>.</span><span class=n>subdomains</span><span class=p>)</span><span class=si>}</span><span class=s2> subdomains...&quot;</span><span class=p>)</span>
</span><span id=__span-10-58><a id=__codelineno-10-58 name=__codelineno-10-58 href=#__codelineno-10-58></a>            <span class=n>resolved</span> <span class=o>=</span> <span class=n>resolve_subdomains</span><span class=p>(</span><span class=n>report</span><span class=o>.</span><span class=n>subdomains</span><span class=p>)</span>
</span><span id=__span-10-59><a id=__codelineno-10-59 name=__codelineno-10-59 href=#__codelineno-10-59></a>            <span class=k>for</span> <span class=n>subdomain</span><span class=p>,</span> <span class=n>ips</span> <span class=ow>in</span> <span class=n>resolved</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span><span id=__span-10-60><a id=__codelineno-10-60 name=__codelineno-10-60 href=#__codelineno-10-60></a>                <span class=n>report</span><span class=o>.</span><span class=n>ip_addresses</span><span class=o>.</span><span class=n>extend</span><span class=p>(</span><span class=n>ips</span><span class=p>)</span>
</span><span id=__span-10-61><a id=__codelineno-10-61 name=__codelineno-10-61 href=#__codelineno-10-61></a>            <span class=n>report</span><span class=o>.</span><span class=n>ip_addresses</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=nb>set</span><span class=p>(</span><span class=n>report</span><span class=o>.</span><span class=n>ip_addresses</span><span class=p>))</span>
</span><span id=__span-10-62><a id=__codelineno-10-62 name=__codelineno-10-62 href=#__codelineno-10-62></a>
</span><span id=__span-10-63><a id=__codelineno-10-63 name=__codelineno-10-63 href=#__codelineno-10-63></a>        <span class=c1># Phase 5: Shodan lookup for discovered IPs</span>
</span><span id=__span-10-64><a id=__codelineno-10-64 name=__codelineno-10-64 href=#__codelineno-10-64></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>shodan_key</span> <span class=ow>and</span> <span class=n>report</span><span class=o>.</span><span class=n>ip_addresses</span><span class=p>:</span>
</span><span id=__span-10-65><a id=__codelineno-10-65 name=__codelineno-10-65 href=#__codelineno-10-65></a>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;[*] Querying Shodan for </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>report</span><span class=o>.</span><span class=n>ip_addresses</span><span class=p>)</span><span class=si>}</span><span class=s2> IPs...&quot;</span><span class=p>)</span>
</span><span id=__span-10-66><a id=__codelineno-10-66 name=__codelineno-10-66 href=#__codelineno-10-66></a>            <span class=kn>import</span><span class=w> </span><span class=nn>shodan</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=nn>shodan_lib</span>
</span><span id=__span-10-67><a id=__codelineno-10-67 name=__codelineno-10-67 href=#__codelineno-10-67></a>            <span class=n>api</span> <span class=o>=</span> <span class=n>shodan_lib</span><span class=o>.</span><span class=n>Shodan</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>shodan_key</span><span class=p>)</span>
</span><span id=__span-10-68><a id=__codelineno-10-68 name=__codelineno-10-68 href=#__codelineno-10-68></a>            <span class=k>for</span> <span class=n>ip</span> <span class=ow>in</span> <span class=n>report</span><span class=o>.</span><span class=n>ip_addresses</span><span class=p>[:</span><span class=mi>20</span><span class=p>]:</span>  <span class=c1># Limit to 20 IPs</span>
</span><span id=__span-10-69><a id=__codelineno-10-69 name=__codelineno-10-69 href=#__codelineno-10-69></a>                <span class=k>try</span><span class=p>:</span>
</span><span id=__span-10-70><a id=__codelineno-10-70 name=__codelineno-10-70 href=#__codelineno-10-70></a>                    <span class=n>host_data</span> <span class=o>=</span> <span class=n>api</span><span class=o>.</span><span class=n>host</span><span class=p>(</span><span class=n>ip</span><span class=p>)</span>
</span><span id=__span-10-71><a id=__codelineno-10-71 name=__codelineno-10-71 href=#__codelineno-10-71></a>                    <span class=n>report</span><span class=o>.</span><span class=n>shodan_results</span><span class=o>.</span><span class=n>append</span><span class=p>({</span>
</span><span id=__span-10-72><a id=__codelineno-10-72 name=__codelineno-10-72 href=#__codelineno-10-72></a>                        <span class=s1>&#39;ip&#39;</span><span class=p>:</span> <span class=n>ip</span><span class=p>,</span>
</span><span id=__span-10-73><a id=__codelineno-10-73 name=__codelineno-10-73 href=#__codelineno-10-73></a>                        <span class=s1>&#39;ports&#39;</span><span class=p>:</span> <span class=p>[</span><span class=n>p</span><span class=p>[</span><span class=s1>&#39;port&#39;</span><span class=p>]</span> <span class=k>for</span> <span class=n>p</span> <span class=ow>in</span> <span class=n>host_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;data&#39;</span><span class=p>,</span> <span class=p>[])],</span>
</span><span id=__span-10-74><a id=__codelineno-10-74 name=__codelineno-10-74 href=#__codelineno-10-74></a>                        <span class=s1>&#39;org&#39;</span><span class=p>:</span> <span class=n>host_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;org&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>),</span>
</span><span id=__span-10-75><a id=__codelineno-10-75 name=__codelineno-10-75 href=#__codelineno-10-75></a>                        <span class=s1>&#39;hostnames&#39;</span><span class=p>:</span> <span class=n>host_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;hostnames&#39;</span><span class=p>,</span> <span class=p>[]),</span>
</span><span id=__span-10-76><a id=__codelineno-10-76 name=__codelineno-10-76 href=#__codelineno-10-76></a>                    <span class=p>})</span>
</span><span id=__span-10-77><a id=__codelineno-10-77 name=__codelineno-10-77 href=#__codelineno-10-77></a>                <span class=k>except</span> <span class=ne>Exception</span><span class=p>:</span>
</span><span id=__span-10-78><a id=__codelineno-10-78 name=__codelineno-10-78 href=#__codelineno-10-78></a>                    <span class=k>pass</span>
</span><span id=__span-10-79><a id=__codelineno-10-79 name=__codelineno-10-79 href=#__codelineno-10-79></a>
</span><span id=__span-10-80><a id=__codelineno-10-80 name=__codelineno-10-80 href=#__codelineno-10-80></a>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;[+] Reconnaissance complete for </span><span class=si>{</span><span class=n>domain</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-10-81><a id=__codelineno-10-81 name=__codelineno-10-81 href=#__codelineno-10-81></a>        <span class=k>return</span> <span class=n>report</span>
</span><span id=__span-10-82><a id=__codelineno-10-82 name=__codelineno-10-82 href=#__codelineno-10-82></a>
</span><span id=__span-10-83><a id=__codelineno-10-83 name=__codelineno-10-83 href=#__codelineno-10-83></a>    <span class=k>def</span><span class=w> </span><span class=nf>generate_report</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>intel_report</span><span class=p>:</span> <span class=n>DomainIntelReport</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span><span id=__span-10-84><a id=__codelineno-10-84 name=__codelineno-10-84 href=#__codelineno-10-84></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Generate formatted intelligence report&quot;&quot;&quot;</span>
</span><span id=__span-10-85><a id=__codelineno-10-85 name=__codelineno-10-85 href=#__codelineno-10-85></a>        <span class=n>lines</span> <span class=o>=</span> <span class=p>[</span>
</span><span id=__span-10-86><a id=__codelineno-10-86 name=__codelineno-10-86 href=#__codelineno-10-86></a>            <span class=sa>f</span><span class=s2>&quot;# Domain Intelligence Report: </span><span class=si>{</span><span class=n>intel_report</span><span class=o>.</span><span class=n>domain</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
</span><span id=__span-10-87><a id=__codelineno-10-87 name=__codelineno-10-87 href=#__codelineno-10-87></a>            <span class=sa>f</span><span class=s2>&quot;**Generated**: </span><span class=si>{</span><span class=n>intel_report</span><span class=o>.</span><span class=n>analysis_timestamp</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
</span><span id=__span-10-88><a id=__codelineno-10-88 name=__codelineno-10-88 href=#__codelineno-10-88></a>            <span class=s2>&quot;&quot;</span><span class=p>,</span>
</span><span id=__span-10-89><a id=__codelineno-10-89 name=__codelineno-10-89 href=#__codelineno-10-89></a>            <span class=s2>&quot;## WHOIS Summary&quot;</span><span class=p>,</span>
</span><span id=__span-10-90><a id=__codelineno-10-90 name=__codelineno-10-90 href=#__codelineno-10-90></a>            <span class=sa>f</span><span class=s2>&quot;- Registrar: </span><span class=si>{</span><span class=n>intel_report</span><span class=o>.</span><span class=n>whois</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;registrar&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;Unknown&#39;</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
</span><span id=__span-10-91><a id=__codelineno-10-91 name=__codelineno-10-91 href=#__codelineno-10-91></a>            <span class=sa>f</span><span class=s2>&quot;- Created: </span><span class=si>{</span><span class=n>intel_report</span><span class=o>.</span><span class=n>whois</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;created&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;Unknown&#39;</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
</span><span id=__span-10-92><a id=__codelineno-10-92 name=__codelineno-10-92 href=#__codelineno-10-92></a>            <span class=sa>f</span><span class=s2>&quot;- Expires: </span><span class=si>{</span><span class=n>intel_report</span><span class=o>.</span><span class=n>whois</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;expires&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;Unknown&#39;</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
</span><span id=__span-10-93><a id=__codelineno-10-93 name=__codelineno-10-93 href=#__codelineno-10-93></a>            <span class=sa>f</span><span class=s2>&quot;- Registrant Org: </span><span class=si>{</span><span class=n>intel_report</span><span class=o>.</span><span class=n>whois</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;registrant_org&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;Unknown&#39;</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
</span><span id=__span-10-94><a id=__codelineno-10-94 name=__codelineno-10-94 href=#__codelineno-10-94></a>            <span class=s2>&quot;&quot;</span><span class=p>,</span>
</span><span id=__span-10-95><a id=__codelineno-10-95 name=__codelineno-10-95 href=#__codelineno-10-95></a>            <span class=s2>&quot;## DNS Infrastructure&quot;</span><span class=p>,</span>
</span><span id=__span-10-96><a id=__codelineno-10-96 name=__codelineno-10-96 href=#__codelineno-10-96></a>            <span class=sa>f</span><span class=s2>&quot;- IP Addresses: </span><span class=si>{</span><span class=s1>&#39;, &#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>intel_report</span><span class=o>.</span><span class=n>dns_records</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;A&#39;</span><span class=p>,</span><span class=w> </span><span class=p>[]))</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
</span><span id=__span-10-97><a id=__codelineno-10-97 name=__codelineno-10-97 href=#__codelineno-10-97></a>            <span class=sa>f</span><span class=s2>&quot;- Mail Servers: </span><span class=si>{</span><span class=s1>&#39;, &#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>intel_report</span><span class=o>.</span><span class=n>dns_records</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;MX&#39;</span><span class=p>,</span><span class=w> </span><span class=p>[]))</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
</span><span id=__span-10-98><a id=__codelineno-10-98 name=__codelineno-10-98 href=#__codelineno-10-98></a>            <span class=sa>f</span><span class=s2>&quot;- Nameservers: </span><span class=si>{</span><span class=s1>&#39;, &#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>intel_report</span><span class=o>.</span><span class=n>dns_records</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;NS&#39;</span><span class=p>,</span><span class=w> </span><span class=p>[]))</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
</span><span id=__span-10-99><a id=__codelineno-10-99 name=__codelineno-10-99 href=#__codelineno-10-99></a>            <span class=s2>&quot;&quot;</span><span class=p>,</span>
</span><span id=__span-10-100><a id=__codelineno-10-100 name=__codelineno-10-100 href=#__codelineno-10-100></a>            <span class=sa>f</span><span class=s2>&quot;## Subdomains Discovered (</span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>intel_report</span><span class=o>.</span><span class=n>subdomains</span><span class=p>)</span><span class=si>}</span><span class=s2>)&quot;</span><span class=p>,</span>
</span><span id=__span-10-101><a id=__codelineno-10-101 name=__codelineno-10-101 href=#__codelineno-10-101></a>        <span class=p>]</span>
</span><span id=__span-10-102><a id=__codelineno-10-102 name=__codelineno-10-102 href=#__codelineno-10-102></a>
</span><span id=__span-10-103><a id=__codelineno-10-103 name=__codelineno-10-103 href=#__codelineno-10-103></a>        <span class=k>for</span> <span class=n>sub</span> <span class=ow>in</span> <span class=n>intel_report</span><span class=o>.</span><span class=n>subdomains</span><span class=p>[:</span><span class=mi>50</span><span class=p>]:</span>
</span><span id=__span-10-104><a id=__codelineno-10-104 name=__codelineno-10-104 href=#__codelineno-10-104></a>            <span class=n>lines</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;- </span><span class=si>{</span><span class=n>sub</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-10-105><a id=__codelineno-10-105 name=__codelineno-10-105 href=#__codelineno-10-105></a>
</span><span id=__span-10-106><a id=__codelineno-10-106 name=__codelineno-10-106 href=#__codelineno-10-106></a>        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>intel_report</span><span class=o>.</span><span class=n>subdomains</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>50</span><span class=p>:</span>
</span><span id=__span-10-107><a id=__codelineno-10-107 name=__codelineno-10-107 href=#__codelineno-10-107></a>            <span class=n>lines</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;... and </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>intel_report</span><span class=o>.</span><span class=n>subdomains</span><span class=p>)</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=mi>50</span><span class=si>}</span><span class=s2> more&quot;</span><span class=p>)</span>
</span><span id=__span-10-108><a id=__codelineno-10-108 name=__codelineno-10-108 href=#__codelineno-10-108></a>
</span><span id=__span-10-109><a id=__codelineno-10-109 name=__codelineno-10-109 href=#__codelineno-10-109></a>        <span class=n>lines</span><span class=o>.</span><span class=n>extend</span><span class=p>([</span>
</span><span id=__span-10-110><a id=__codelineno-10-110 name=__codelineno-10-110 href=#__codelineno-10-110></a>            <span class=s2>&quot;&quot;</span><span class=p>,</span>
</span><span id=__span-10-111><a id=__codelineno-10-111 name=__codelineno-10-111 href=#__codelineno-10-111></a>            <span class=sa>f</span><span class=s2>&quot;## Internet-Exposed Services (</span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>intel_report</span><span class=o>.</span><span class=n>shodan_results</span><span class=p>)</span><span class=si>}</span><span class=s2> IPs analyzed)&quot;</span><span class=p>,</span>
</span><span id=__span-10-112><a id=__codelineno-10-112 name=__codelineno-10-112 href=#__codelineno-10-112></a>        <span class=p>])</span>
</span><span id=__span-10-113><a id=__codelineno-10-113 name=__codelineno-10-113 href=#__codelineno-10-113></a>
</span><span id=__span-10-114><a id=__codelineno-10-114 name=__codelineno-10-114 href=#__codelineno-10-114></a>        <span class=k>for</span> <span class=n>sh</span> <span class=ow>in</span> <span class=n>intel_report</span><span class=o>.</span><span class=n>shodan_results</span><span class=p>:</span>
</span><span id=__span-10-115><a id=__codelineno-10-115 name=__codelineno-10-115 href=#__codelineno-10-115></a>            <span class=n>lines</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;- </span><span class=si>{</span><span class=n>sh</span><span class=p>[</span><span class=s1>&#39;ip&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2> (</span><span class=si>{</span><span class=n>sh</span><span class=p>[</span><span class=s1>&#39;org&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>): ports </span><span class=si>{</span><span class=n>sh</span><span class=p>[</span><span class=s1>&#39;ports&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-10-116><a id=__codelineno-10-116 name=__codelineno-10-116 href=#__codelineno-10-116></a>
</span><span id=__span-10-117><a id=__codelineno-10-117 name=__codelineno-10-117 href=#__codelineno-10-117></a>        <span class=k>return</span> <span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>lines</span><span class=p>)</span>
</span></code></pre></div> <hr> <h2 id=68-threat-actor-infrastructure-research>6.8 Threat Actor Infrastructure Research<a class=headerlink href=#68-threat-actor-infrastructure-research title="Permanent link">&para;</a></h2> <p>One of the most important applications of network reconnaissance in cybersecurity is mapping threat actor infrastructure — the domains, IPs, and servers used by malicious actors for command-and-control, phishing, and malware distribution.</p> <h3 id=infrastructure-correlation-techniques>Infrastructure Correlation Techniques<a class=headerlink href=#infrastructure-correlation-techniques title="Permanent link">&para;</a></h3> <p>Threat actors often reuse infrastructure patterns that enable tracking:</p> <p><strong>Nameserver clustering</strong>: Malicious domains registered through specific registrars or using specific nameservers can be grouped and monitored.</p> <p><strong>SSL certificate patterns</strong>: Threat actors who use self-signed certificates or certificates from specific CAs with specific organizational details can be identified through certificate search.</p> <p><strong>Registration pattern analysis</strong>: Domains registered at the same time, with the same registrar, using similar naming patterns, or sharing WHOIS data (historical) reveal coordinated registration campaigns.</p> <p><strong>IP neighborhood analysis</strong>: Malicious domains often share IP space. Finding one malicious domain on an IP block suggests investigating neighboring IPs.</p> <p><strong>RiskIQ / Microsoft Defender for Threat Intelligence</strong> provides specialized passive DNS and certificate data tuned for threat intelligence use cases.</p> <hr> <h2 id=summary>Summary<a class=headerlink href=#summary title="Permanent link">&para;</a></h2> <p>Domain and network reconnaissance provides a technical layer of OSINT that is largely invisible through content-focused investigation. DNS records, WHOIS data, certificate transparency logs, passive DNS databases, and internet scanning services like Shodan reveal organizational infrastructure, hosting relationships, email systems, and historical presence that complement and enrich other OSINT findings.</p> <p>Effective network reconnaissance requires passive data collection from multiple sources, combined into a coherent picture through systematic analysis. Automated pipelines enable repeatable, comprehensive coverage that would be impractical to achieve manually.</p> <p>The same techniques that security professionals use for attack surface analysis serve broader OSINT purposes: corporate investigations, threat intelligence, fraud investigation, and organizational mapping.</p> <hr> <h2 id=common-mistakes-and-pitfalls>Common Mistakes and Pitfalls<a class=headerlink href=#common-mistakes-and-pitfalls title="Permanent link">&para;</a></h2> <ul> <li><strong>Relying on current WHOIS only</strong>: Historical WHOIS data often reveals what current privacy-protected records hide</li> <li><strong>Single-tool recon</strong>: Any single tool has coverage gaps; always correlate across multiple sources</li> <li><strong>Ignoring certificate transparency</strong>: CT logs are among the most overlooked and most valuable subdomain discovery sources</li> <li><strong>Active probing without authorization</strong>: Active scanning of systems is potentially illegal without explicit authorization; passive reconnaissance from public databases is unambiguously legal</li> <li><strong>Treating Shodan results as current</strong>: Shodan scans are periodic; a result from weeks ago may not reflect current status</li> <li><strong>Missing ASN analysis</strong>: ASN research connects disparate IP ranges to the same organization</li> </ul> <hr> <h2 id=further-reading>Further Reading<a class=headerlink href=#further-reading title="Permanent link">&para;</a></h2> <ul> <li>SANS FOR578 Threat Intelligence — network infrastructure analysis modules</li> <li>Krebs on Security — Brian Krebs's investigative reporting demonstrates infrastructure tracking methodology</li> <li>DomainTools blog — frequent practitioner-focused articles on domain intelligence</li> <li>MITRE ATT&amp;CK — threat actor infrastructure patterns in documented groups</li> <li>Shodan documentation — comprehensive operator and API reference</li> </ul> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../chapter-05/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Ch 5: Social Media Intelligence"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> Previous </span> <div class=md-ellipsis> Ch 5: Social Media Intelligence </div> </div> </a> <a href=../chapter-07/ class="md-footer__link md-footer__link--next" aria-label="Next: Ch 7: Public Records"> <div class=md-footer__title> <span class=md-footer__direction> Next </span> <div class=md-ellipsis> Ch 7: Public Records </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2025 CloudStreet </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/cloudstreet-dev/The-Open-Source-Intelligence-Bible target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"annotate": null, "base": "../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.expand", "navigation.top", "navigation.footer", "search.highlight", "search.suggest", "content.code.copy", "content.code.annotate", "toc.follow"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src=../../assets/javascripts/bundle.79ae519e.min.js></script> </body> </html>